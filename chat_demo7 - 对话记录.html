<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>æ™ºèƒ½è´·æ¬¾é¡¾é—® - 3åˆ†é’Ÿæé€Ÿæ”¾æ¬¾</title>
    <style>
        * {margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;}
        :root {
            --primary-color: #00C853;
            --primary-gradient: linear-gradient(135deg, #00C853, #009624);
            --secondary-color: #F5F5F5;
            --text-primary: #2C3E50;
            --text-secondary: #7F8C8D;
            --shadow-sm: 0 2px 4px rgba(0,0,0,0.05);
            --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
        }
body {font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,sans-serif;background-color:#F8FAFC;color:var(--text-primary);line-height:1.6;}
.chat-container {max-width:600px;margin:0 auto;padding:70px 16px 80px;background:#fff;min-height:100vh;position:relative;}
.chat-header {position:fixed;top:0;left:0;right:0;background:var(--primary-gradient);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);color:#fff;padding:12px 0;z-index:100;max-width:600px;margin:0 auto;}
.chat-header-content {display:flex;flex-direction:column;align-items:center;padding:0 16px;}
.chat-header-title {font-size:18px;font-weight:600;margin-bottom:4px;}
.chat-header-subtitle {font-size:12px;opacity:0.9;}
.message {margin:16px 0;display:flex;align-items:flex-start;animation:messageSlide 0.3s ease-out;}
@keyframes messageSlide {from{opacity:0;transform:translateY(10px);}to{opacity:1;transform:translateY(0);}}
.message-content {max-width:85%;padding:14px 18px;border-radius:var(--radius-md);box-shadow:var(--shadow-sm);position:relative;}
.user-message {justify-content:flex-end;}
.user-message .message-content {background:var(--primary-gradient);color:#fff;margin-right:12px;border-bottom-right-radius:4px;}
.system-message {justify-content:flex-start;}
.system-message .message-content {background:#fff;border:1px solid #E5E9F2;margin-left:12px;border-bottom-left-radius:4px;}
.info-card {background:#F8FAFC;border-radius:var(--radius-md);padding:16px;margin:12px 0;border:1px solid #E5E9F2;}
.info-card-title {font-weight:600;color:var(--text-primary);margin-bottom:8px;display:flex;align-items:center;gap:6px;}
.info-card-content {color:var(--text-secondary);font-size:14px;line-height:1.8;}
.badge {display:inline-flex;align-items:center;padding:4px 8px;background:rgba(0,200,83,0.1);color:var(--primary-color);border-radius:100px;font-size:12px;font-weight:500;gap:4px;}
.trust-badge {display:flex;align-items:center;gap:8px;padding:8px 12px;background:rgba(0,200,83,0.1);border-radius:var(--radius-sm);font-size:13px;color:var(--primary-color);margin:12px 0;}
.action-buttons {display:flex;flex-wrap:wrap;gap:8px;margin-top:12px;}
.action-button {background:var(--primary-gradient);color:#fff;border:none;padding:10px 20px;border-radius:var(--radius-sm);font-weight:500;font-size:14px;cursor:pointer;transition:all 0.3s ease;display:flex;align-items:center;gap:6px;}
.action-button:hover {transform:translateY(-1px);box-shadow:var(--shadow-md);}
.action-button.secondary {background:#fff;border:1px solid #E5E9F2;color:var(--text-primary);}
.chat-input {position:fixed;bottom:0;left:0;right:0;background:#fff;padding:12px 16px;box-shadow:0 -2px 10px rgba(0,0,0,0.05);display:flex;flex-direction:column;gap:0;max-width:600px;margin:0 auto;border-top:1px solid #E5E9F2;z-index:99;}
.quick-actions {display:flex;gap:8px;margin-bottom:8px;padding:0 16px;}
.quick-action-btn {flex:1;display:flex;align-items:center;justify-content:center;gap:6px;padding:8px 12px;background:#fff;border:1px solid #E5E9F2;border-radius:var(--radius-sm);color:var(--text-primary);font-size:14px;cursor:pointer;transition:all 0.3s ease;}
.quick-action-btn:hover {border-color:var(--primary-color);color:var(--primary-color);background:rgba(0,200,83,0.05);}
.quick-action-btn span:first-child {font-size:16px;}
.input-row {display:flex;flex-direction:row;gap:12px;}
.chat-input input {flex:1;padding:12px 16px;border:1px solid #E5E9F2;border-radius:var(--radius-sm);font-size:15px;transition:all 0.3s ease;}
.chat-input input:focus {outline:none;border-color:var(--primary-color);box-shadow:0 0 0 3px rgba(0,200,83,0.1);}
.progress-bar {background:#E5E9F2;height:6px;border-radius:3px;margin:12px 0;overflow:hidden;}
.progress-bar-fill {background:var(--primary-gradient);height:100%;border-radius:3px;transition:width 0.6s ease;}
.stats {display:flex;gap:16px;margin:12px 0;}
.stat-item {display:flex;flex-direction:column;align-items:center;}
.stat-value {font-size:22px;font-weight:600;}
.stat-label {font-size:12px;color:var(--text-secondary);}
.info-card.success-card {border:1px solid #00C853;background:#E8F5E9;}
.info-card.error-card {border:1px solid #FF5252;background:#FFF0F0;}
.result-summary {margin:12px 0;}
.result-item {display:flex;justify-content:space-between;margin-bottom:6px;}
.label {color:var(--text-secondary);}
.value {color:var(--text-primary);font-weight:500;}
.gift-package-banner {position:fixed;top:70px;left:0;right:0;background:linear-gradient(135deg,#FF6B6B,#FF8E8E);color:#fff;padding:12px 16px;display:flex;align-items:center;gap:12px;cursor:pointer;z-index:99;max-width:600px;margin:0 auto;border-radius:0 0 var(--radius-md) var(--radius-md);box-shadow:var(--shadow-md);animation:slideDown 0.5s ease-out;}
@keyframes slideDown {from{transform:translateY(-100%);}to{transform:translateY(0);}}
.gift-icon {font-size:24px;animation:bounce 2s infinite;}
@keyframes bounce {0%,100%{transform:translateY(0);}50%{transform:translateY(-5px);}}
.gift-text {flex:1;}
.gift-title {font-weight:600;font-size:16px;margin-bottom:2px;}
.gift-desc {font-size:12px;opacity:0.9;}
.gift-arrow {font-size:20px;}
.gift-close-btn {position:absolute;right:16px;top:12px;color:#fff;background:rgba(0,0,0,0.15);border-radius:50%;width:28px;height:28px;display:flex;align-items:center;justify-content:center;transition:background 0.2s;z-index:2;}
.gift-close-btn:hover {background:rgba(0,0,0,0.25);}
.gift-package-modal {position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:1000;animation:fadeIn 0.3s ease-out;}
@keyframes fadeIn {from{opacity:0;}to{opacity:1;}}
.gift-package-content {background:#fff;border-radius:var(--radius-lg);width:90%;max-width:400px;max-height:80vh;overflow-y:auto;animation:scaleIn 0.3s ease-out;}
@keyframes scaleIn {from{transform:scale(0.9);}to{transform:scale(1);}}
.gift-package-header {background:linear-gradient(135deg,#FF6B6B,#FF8E8E);color:#fff;padding:20px;text-align:center;border-radius:var(--radius-lg) var(--radius-lg) 0 0;}
.gift-package-title {font-size:20px;font-weight:600;margin-bottom:8px;}
.gift-package-subtitle {font-size:14px;opacity:0.9;}
.gift-package-body {padding:20px;}
.gift-item {display:flex;align-items:center;gap:12px;padding:12px;background:#F8FAFC;border-radius:var(--radius-sm);margin-bottom:12px;}
.gift-item-icon {width:40px;height:40px;background:rgba(255,107,107,0.1);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:20px;color:#FF6B6B;}
.gift-item-info {flex:1;}
.gift-item-title {font-weight:500;margin-bottom:4px;}
.gift-item-desc {font-size:12px;color:var(--text-secondary);}
.gift-item-value {font-weight:600;color:#FF6B6B;}
.gift-package-footer {padding:16px 20px;border-top:1px solid #E5E9F2;text-align:center;}
.gift-package-btn {background:linear-gradient(135deg,#FF6B6B,#FF8E8E);color:#fff;border:none;padding:12px 24px;border-radius:var(--radius-sm);font-weight:500;cursor:pointer;transition:all 0.3s ease;}
.gift-package-btn:hover {transform:translateY(-2px);box-shadow:var(--shadow-md);}
.gift-package-close {position:absolute;top:16px;right:16px;color:#fff;font-size:24px;cursor:pointer;opacity:0.8;transition:opacity 0.3s ease;}
.gift-package-close:hover {opacity:1;}
.progress-steps {margin:20px 0;}
.progress-step {display:flex;align-items:flex-start;gap:12px;margin-bottom:16px;position:relative;}
.progress-step:not(:last-child)::after {content:'';position:absolute;left:15px;top:30px;bottom:-14px;width:2px;background:#E5E9F2;}
.progress-step.completed:not(:last-child)::after {background:var(--primary-color);}
.step-icon {width:32px;height:32px;border-radius:50%;background:#F8FAFC;border:2px solid #E5E9F2;display:flex;align-items:center;justify-content:center;font-size:14px;z-index:1;}
.progress-step.completed .step-icon {border-color:var(--primary-color);background:var(--primary-color);color:#fff;}
.progress-step.active .step-icon {border-color:var(--primary-color);color:var(--primary-color);}
.step-info {flex:1;}
.step-title {font-weight:500;color:var(--text-primary);}
.step-time {font-size:12px;color:var(--text-secondary);}
.approval-details {display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin:16px 0;background:#F8FAFC;padding:16px;border-radius:var(--radius-md);}
.detail-item {text-align:center;}
.detail-label {font-size:12px;color:var(--text-secondary);margin-bottom:4px;}
.detail-value {font-size:16px;font-weight:600;color:var(--primary-color);}
.info-item {display:flex;justify-content:space-between;margin-bottom:8px;font-size:14px;}
.info-item .label {color:var(--text-secondary);}
.info-item .value {color:var(--text-primary);font-weight:500;}
.comparison-section {margin:16px 0;}
.comparison-table {width:100%;border-collapse:collapse;margin:16px 0;background:#fff;border-radius:var(--radius-md);box-shadow:var(--shadow-sm);table-layout:fixed;}
.comparison-table th,.comparison-table td {padding:12px 8px;text-align:center;border-bottom:1px solid #E5E9F2;font-size:13px;line-height:1.4;}
.comparison-table th {background:#F8FAFC;font-weight:600;color:var(--text-primary);white-space:nowrap;}
.comparison-table td {color:var(--text-secondary);}
.comparison-table tr.highlight {background:rgba(0,200,83,0.05);}
.comparison-table tr.highlight td {color:var(--primary-color);font-weight:600;}
.comparison-table .better {color:#00C853;font-weight:500;}
.comparison-table .worse {color:#FF5252;font-weight:500;}
.comparison-table tr:last-child td {border-bottom:none;}
.comparison-table tr:hover td {background:rgba(0,200,83,0.02);}
.comparison-table tr.highlight:hover td {background:rgba(0,200,83,0.08);}
.comparison-table th:nth-child(1),.comparison-table td:nth-child(1) {width:15%;}
.comparison-table th:nth-child(2),.comparison-table td:nth-child(2),.comparison-table th:nth-child(3),.comparison-table td:nth-child(3) {width:15%;}
.comparison-table th:nth-child(4),.comparison-table td:nth-child(4),.comparison-table th:nth-child(5),.comparison-table td:nth-child(5) {width:15%;}
.comparison-table th:nth-child(6),.comparison-table td:nth-child(6) {width:25%;}
.coupon-list {display:flex;flex-direction:column;gap:12px;}
.coupon-item {background:#fff;border:1px solid #E5E9F2;border-radius:var(--radius-sm);padding:16px;display:flex;align-items:center;gap:12px;}
.coupon-icon {width:40px;height:40px;background:rgba(0,200,83,0.1);border-radius:50%;display:flex;align-items:center;justify-content:center;color:var(--primary-color);}
.coupon-info {flex:1;}
.coupon-name {font-weight:500;margin-bottom:4px;}
.coupon-desc {font-size:12px;color:var(--text-secondary);}
.coupon-value {font-weight:600;color:var(--primary-color);}
.irr-qmark {display:inline-block;margin-left:4px;color:#00C853;background:#E5F9EF;border-radius:50%;width:16px;height:16px;font-size:12px;text-align:center;line-height:16px;cursor:pointer;border:1px solid #B2F2D7;font-weight:bold;transition:background 0.2s;}
.irr-qmark:hover {background:#B2F2D7;}
        @media (prefers-color-scheme: dark) {
    :root {--text-primary:#E5E9F2;--text-secondary:#A0AEC0;}
    body {background-color:#1A202C;}
    .chat-container {background:#1A202C;}
    .system-message .message-content {background:#2D3748;border-color:#4A5568;}
    .info-card {background:#2D3748;border-color:#4A5568;}
    .chat-input {background:#2D3748;border-color:#4A5568;}
    .chat-input input {background:#1A202C;border-color:#4A5568;color:#fff;}
    .form-group select,.form-group input {background:#1A202C;border-color:#4A5568;color:#fff;}
    .upload-area {border-color:#4A5568;}
    .step {background:#1A202C;}
}
@media screen and (max-width:768px) {
    .chat-header {padding:8px 0;}
    .chat-container {padding:60px 12px 70px;}
    .message-content {max-width:90%;}
    .action-button {padding:8px 16px;}
    .stats {gap:8px;}
    .stat-value {font-size:18px;}
}
@keyframes spin { 0%{transform:rotate(0);} 100%{transform:rotate(360deg);} }
@keyframes breathBtn {
  0% { box-shadow:0 4px 16px rgba(0,200,83,0.10); transform:scale(1); }
  60% { box-shadow:0 8px 32px 4px rgba(0,200,83,0.18); transform:scale(1.06); }
  100% { box-shadow:0 4px 16px rgba(0,200,83,0.10); transform:scale(1); }
        }
    </style>
    <!-- åœ¨æ ·å¼åŒºå¢åŠ åŠ¨æ•ˆ -->
    <style>
        @keyframes best-bounce {0%{transform:translateY(0);}100%{transform:translateY(-8px) scale(1.06);}}
        @keyframes slideDown {from{opacity:0;transform:translateY(-10px);}to{opacity:1;transform:translateY(0);}}
        @keyframes valueChipPulse {0%{transform:scale(1);}50%{transform:scale(1.05);}100%{transform:scale(1);}}
        @keyframes barGrow {from{width:0;}to{width:var(--bar-width);}}
        @keyframes circleGrow {from{stroke-dasharray:0 314;}to{stroke-dasharray:var(--circle-dash) 314;}}
        @keyframes fadeInUp {from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
        @keyframes scaleIn {from{transform:scale(0.8);opacity:0;}to{transform:scale(1);opacity:1;}}
        
        /* æ–°å¢ï¼šä¼˜æƒ ä»·å€¼èŠ¯ç‰‡åŠ¨ç”» */
        .value-chip {
            transition: all 0.3s ease;
            animation: valueChipPulse 2s ease-in-out infinite;
        }
        .value-chip:hover {
            transform: scale(1.1);
            background: rgba(255,255,255,0.3) !important;
        }
        
        /* æ–°å¢ï¼šIRRæŸ±å­æ‚¬åœæ•ˆæœ */
        .irr-bar {
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .irr-bar:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        /* æ–°å¢ï¼šå·¥å…·æç¤ºåŠ¨ç”» */
        .irr-tooltip {
            animation: slideDown 0.3s ease-out;
        }
        
        /* æ–°å¢ï¼šå¡ç‰‡æ‚¬åœæ•ˆæœ */
        .deal-activity-card:hover,
        .deal-coupon-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0,200,83,0.15);
        }
        
        /* æ–°å¢ï¼šè¾“å…¥æ¡†ç„¦ç‚¹æ•ˆæœ */
        input:focus, select:focus {
            border-color: #00C853 !important;
            box-shadow: 0 0 0 3px rgba(0,200,83,0.1) !important;
            transform: scale(1.02);
        }
        
        /* æ–°å¢ï¼šæŒ‰é’®æ‚¬åœæ•ˆæœ */
        .action-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,200,83,0.25);
        }
        
        /* æ–°å¢ï¼šç¯å½¢è¿›åº¦å›¾åŠ¨ç”» */
        .circle-progress {
            animation: circleGrow 1.5s ease-out;
        }
        
        /* æ–°å¢ï¼šæ¨ªå‘è¿›åº¦æ¡åŠ¨ç”» */
        .progress-bar {
            animation: barGrow 1s ease-out;
        }
        
        /* æ–°å¢ï¼šé¡µé¢å…ƒç´ è¿›å…¥åŠ¨ç”» */
        .fade-in-up {
            animation: fadeInUp 0.6s ease-out;
        }
        
        .scale-in {
            animation: scaleIn 0.5s ease-out;
        }
        
        /* æ–°å¢ï¼šä¸‰ä¸ªæ ¸å¿ƒæ¨¡å—çš„æ•´ä½“æ€§æ ·å¼ */
        .core-modules-container {
            position: relative;
        }
        
        .core-modules-container::before {
            content: '';
            position: absolute;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 2px;
            background: linear-gradient(180deg, transparent, #00C853, transparent);
            transform: translateX(-50%);
            z-index: 1;
        }
        
        .module-card {
            position: relative;
            z-index: 2;
            transition: all 0.3s ease;
        }
        
        .module-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0,200,83,0.15);
        }
        
        .module-connector {
            position: relative;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto;
        }
        
        .module-connector::before {
            content: '';
            width: 8px;
            height: 8px;
            background: #00C853;
            border-radius: 50%;
            box-shadow: 0 0 0 4px rgba(0,200,83,0.1);
        }
        
        .module-connector::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 2px;
            height: 20px;
            background: linear-gradient(180deg, #00C853, transparent);
        }
        
        /* æ–°å¢ï¼šæ¨¡å—é«˜äº®æ•ˆæœ */
        .module-highlight {
            animation: modulePulse 2s ease-in-out infinite;
        }
        
        @keyframes modulePulse {
            0%, 100% { box-shadow: 0 8px 32px rgba(0,200,83,0.1); }
            50% { box-shadow: 0 8px 32px rgba(0,200,83,0.25); }
        }
        
        /* æ–°å¢ï¼šè¿›åº¦æŒ‡ç¤ºå™¨ */
        .progress-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin: 16px 0;
            font-size: 12px;
            color: #7F8C8D;
        }
        
        .progress-step {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .progress-step.active {
            color: #00C853;
            font-weight: 600;
        }
        
        .progress-step.completed {
            color: #00C853;
        }
        
        .progress-step.completed::before {
            content: 'âœ“';
            color: #00C853;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="chat-header">
        <div class="chat-header-content">
            <div class="chat-header-title">æ™ºèƒ½è´·æ¬¾é¡¾é—®</div>
            <div class="chat-header-subtitle">
                <span class="badge">
                    <span>ğŸ”¥</span>
                    <span>æœ€è¿‘1å°æ—¶æ”¾æ¬¾2,358ç¬”</span>
                </span>
            </div>
        </div>
    </div>

    <div class="chat-container">
        <div class="gift-package-banner" id="giftBanner" onclick="loanApp.showGiftPackage()">
            <div class="gift-icon">ğŸ</div>
            <div class="gift-text">
                <div class="gift-title">å¤©é™å¤§ç¤¼åŒ…</div>
                <div class="gift-desc">æ–°äººä¸“äº«ä¼˜æƒ </div>
            </div>
            <div class="gift-arrow">â†’</div>
            <div class="gift-close-btn" onclick="event.stopPropagation();document.getElementById('giftBanner').style.display='none';" style="margin-left:8px;font-size:20px;cursor:pointer;user-select:none;">Ã—</div>
        </div>
        <div class="chat-messages">
            <!-- ä¼˜åŒ–å¼€åœºç™½ -->
            <div class="message system-message">
                <div class="message-content">
                    æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„ä¸“å±æ™ºèƒ½è´·æ¬¾é¡¾é—®å°è´·ã€‚ğŸ‘‹
                    
                    <div class="info-card">
                        <div class="info-card-title">
                            <span>ğŸ¯</span>
                            <span>æé€Ÿè´·æ¬¾3å¤§ä¼˜åŠ¿</span>
                        </div>
                        <div class="stats">
                            <div class="stat-item">
                                <div class="stat-value">âš¡ï¸</div>
                                <div class="stat-label">3åˆ†é’Ÿæé€Ÿå®¡æ‰¹</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">ğŸ’°</div>
                                <div class="stat-label">æœ€é«˜å¯è´·50ä¸‡</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">ğŸ’«</div>
                                <div class="stat-label">åˆ©ç‡ä½è‡³0.3%</div>
                            </div>
                        </div>
                    </div>

                    <div class="info-card">
                        <div class="info-card-title">
                            <span>ğŸ</span>
                            <span>æ–°äººä¸“äº«ç¦åˆ©</span>
                        </div>
                        <div class="info-card-content">
                            Â· é¦–ç¬”è´·æ¬¾7å¤©å…æ¯
                            Â· é¢åº¦ç‰¹äº«ä¸Šæµ®20%
                            Â· å®¡æ‰¹é€šé“ä¼˜å…ˆ
                            Â· ä¸“å±å®¢æœæœåŠ¡
                        </div>
                    </div>

                    <div class="trust-badge">
                        <span>ğŸ¦ é“¶è¡Œå­˜ç®¡</span>
                        <span>|</span>
                        <span>ğŸ”’ éšç§åŠ å¯†</span>
                        <span>|</span>
                        <span>ğŸ“± 5000ä¸‡ç”¨æˆ·ä¿¡èµ–ä¹‹é€‰</span>
                    </div>

                    <div class="action-buttons">
                        <button class="action-button" onclick="loanApp.startEvaluation()">
                            <span>ğŸ‘‰</span>
                            <span>ç«‹å³ç”³è¯·</span>
                        </button>
                        <button class="action-button secondary" onclick="loanApp.checkQuota()">
                            <span>ğŸ’¡</span>
                            <span>é¢åº¦è¯•ç®—</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="chat-input">
            <div class="quick-actions">
                <button class="quick-action-btn" onclick="loanApp.showBestDealsPage()">
                    <span>ğŸ’</span>
                    <span>é†‰åˆ’ç®—æ”»ç•¥</span>
                </button>
                <button class="quick-action-btn" onclick="loanApp.startWithdraw()">
                    <span>ğŸ’°</span>
                    <span>ç«‹å³æç°</span>
                </button>
                <button class="quick-action-btn" onclick="loanApp.viewRepaymentPlan()">
                    <span>ğŸ’³</span>
                    <span>ä¸€é”®è¿˜æ¬¾</span>
                </button>
            </div>
            <div class="input-row">
                <input type="text" placeholder="è¾“å…¥æ‚¨çš„é—®é¢˜ï¼ŒAIé¡¾é—®é©¬ä¸Šä¸ºæ‚¨è§£ç­”...">
                <button class="action-button">å‘é€</button>
            </div>
        </div>
    </div>

    <script>
        // ä¼˜åŒ– LoanApplicationManager ç±»
        class LoanApplicationManager {
            constructor() {
                this.currentStep = 0;
                this.applicationData = {
                    userId: 'USER_' + Math.random().toString(36).substr(2, 9),
                    idCard: null,
                    faceVerified: false,
                    preCheckPassed: false,
                    personalInfo: null,
                    applyId: 'APPLY_' + Math.random().toString(36).substr(2, 9),
                    contact1: {
                        name: '',
                        phone: '',
                        relation: ''
                    },
                    contact2: {
                        name: '',
                        phone: '',
                        relation: ''
                    }
                };
                
                // ç»‘å®šæ–¹æ³•åˆ°å®ä¾‹
                this.startApplication = this.startApplication.bind(this);
                this.checkQuota = this.checkQuota.bind(this);
                this.startIdCardOCR = this.startIdCardOCR.bind(this);
                this.simulateUpload = this.simulateUpload.bind(this);
                this.handleFrontUploadSuccess = this.handleFrontUploadSuccess.bind(this);
                this.handleBackUploadSuccess = this.handleBackUploadSuccess.bind(this);
                this.startFaceVerification = this.startFaceVerification.bind(this);
                this.confirmWithdraw = this.confirmWithdraw.bind(this);
                this.checkProgress = this.checkProgress.bind(this);
                // ... ç»‘å®šå…¶ä»–æ–¹æ³•
                
                // æ·»åŠ åœ°å€æ•°æ®
                this.addressData = {}

                // æ·»åŠ ç™»å½•çŠ¶æ€
                this.isLoggedIn = false;
                
                // ç»‘å®šç™»å½•ç›¸å…³æ–¹æ³•
                this.showLogin = this.showLogin.bind(this);
                this.sendVerifyCode = this.sendVerifyCode.bind(this);
                this.verifyCode = this.verifyCode.bind(this);
                
                // æ·»åŠ ä¼˜æƒ æ´»åŠ¨æ•°æ®
                this.benefits = {
                    coupons: [
                        { id: 1, name: '7å¤©å…æ¯åˆ¸', value: 100, type: 'interest_free' },
                        { id: 2, name: '8æŠ˜åˆ©ç‡åˆ¸', value: 200, type: 'discount' },
                        { id: 3, name: '50å…ƒæŠµæ‰£åˆ¸', value: 50, type: 'deduction' }
                    ],
                    luckyDraw: {
                        prize: '10gé»„é‡‘',
                        probability: 0.1,
                        value: 5000
                    },
                    checkIn: {
                        days: 5,
                        value: 50
                    },
                    redPacket: {
                        total: 10000,
                        participants: 1000,
                        value: 10
                    }
                };
                
                // æ·»åŠ ç«å“æ•°æ®
                this.competitors = [
                    { name: 'ç«å“A', irr: 0.15, features: ['å¤šé¡¹æœåŠ¡è´¹'] },
                    { name: 'ç«å“B', irr: 0.12, features: ['é™„åŠ è´¹ç”¨å¤š'] },
                    { name: 'ç«å“C', irr: 0.13, features: ['æœ‰ç®¡ç†è´¹'] }
                ];

                // æ·»åŠ ä¼˜æƒ æ´»åŠ¨æ•°æ®
                this.activePromotions = [
                    {
                        id: 1,
                        title: "æ–°äººä¸“äº«",
                        description: "é¦–ç¬”è´·æ¬¾äº«7å¤©å…æ¯ç‰¹æƒ",
                        value: 100,
                        type: "interest_free",
                        icon: "ğŸ"
                    },
                    {
                        id: 2,
                        title: "é™æ—¶ä¼˜æƒ ",
                        description: "8æŠ˜åˆ©ç‡åˆ¸ï¼Œæœ€é«˜çœ2000å…ƒ",
                        value: 200,
                        type: "discount",
                        icon: "ğŸ’°"
                    },
                    {
                        id: 3,
                        title: "ç­¾åˆ°å¥–åŠ±",
                        description: "è¿ç»­ç­¾åˆ°7å¤©ï¼Œé€50å…ƒæŠµæ‰£åˆ¸",
                        value: 50,
                        type: "deduction",
                        icon: "ğŸ“…"
                    }
                ];
            }

            // å¼€å§‹ç”³è¯·æµç¨‹
            async startApplication() {
                if (!this.isLoggedIn) {
                    this.showLogin();
                    return;
                }
                
                chatManager.addSystemMessage(`
                   
                `);
            }

            // å¼€å§‹èº«ä»½è¯è¯†åˆ«
            async startIdCardOCR() {
                chatManager.addSystemMessage(`
                    
                `);
            }

            // æ¨¡æ‹Ÿä¸Šä¼ 
            async simulateUpload(side) {
                chatManager.addSystemMessage(`
                    
                `);

                let progress = 0;
                const interval = setInterval(() => {
                    progress += 20;
                    document.querySelector('.progress-bar-fill').style.width = `${progress}%`;
                    if (progress >= 100) {
                        clearInterval(interval);
                        if (side === 'front') {
                            this.handleFrontUploadSuccess();
                        } else {
                            this.handleBackUploadSuccess();
                        }
                    }
                }, 300);
            }

            // å¤„ç†æ­£é¢ä¸Šä¼ æˆåŠŸ
            handleFrontUploadSuccess() {
                chatManager.addSystemMessage(`
                    
                `);
            }

            // å¤„ç†åé¢ä¸Šä¼ æˆåŠŸ
            handleBackUploadSuccess() {
                chatManager.addSystemMessage(`
                   
                `);
            }

            // å¼€å§‹æ´»ä½“æ£€æµ‹
            async startFaceVerification() {
                chatManager.addSystemMessage(`
                    
                `);
            }

            // ä¿®æ”¹æ¨¡æ‹Ÿäººè„¸æ£€æµ‹æ–¹æ³•
            async simulateFaceVerify() {}

            // æ·»åŠ äººè„¸éªŒè¯æˆåŠŸå¤„ç†æ–¹æ³•
            handleFaceVerifySuccess() {}

            // å¤„ç†äººè„¸æ£€æµ‹æˆåŠŸ
            handleFaceCheckSuccess() {}

            // æ”¶é›†ä¸ªäººä¿¡æ¯
            startPersonalInfoCollection() {}

            // æ”¶é›†åœ°å€ä¿¡æ¯
            collectAddress() {}

            // åŠ è½½åŸå¸‚é€‰é¡¹
            loadCities(type = 'residence') {
                const prefix = type === 'residence' ? 'residence' : 'company';
                const provinceSelect = document.getElementById(`${prefix}Province`);
                const citySelect = document.getElementById(`${prefix}City`);
                const districtSelect = document.getElementById(`${prefix}District`);
                
                const selectedProvince = provinceSelect.value;
                
                // é‡ç½®åŸå¸‚å’ŒåŒºåŸŸé€‰æ‹©
                citySelect.innerHTML = '<option value="">è¯·é€‰æ‹©åŸå¸‚</option>';
                districtSelect.innerHTML = '<option value="">è¯·å…ˆé€‰æ‹©åŸå¸‚</option>';
                
                if (selectedProvince) {
                    const cities = this.addressData[selectedProvince].cities;
                    citySelect.disabled = false;
                    
                    Object.keys(cities).forEach(cityKey => {
                        const city = cities[cityKey];
                        const option = document.createElement('option');
                        option.value = cityKey;
                        option.textContent = city.name;
                        citySelect.appendChild(option);
                    });
                } else {
                    citySelect.disabled = true;
                    districtSelect.disabled = true;
                }
            }

            // åŠ è½½åŒºåŸŸé€‰é¡¹
            loadDistricts(type = 'residence') {
                const prefix = type === 'residence' ? 'residence' : 'company';
                const provinceSelect = document.getElementById(`${prefix}Province`);
                const citySelect = document.getElementById(`${prefix}City`);
                const districtSelect = document.getElementById(`${prefix}District`);
                
                const selectedProvince = provinceSelect.value;
                const selectedCity = citySelect.value;
                
                // é‡ç½®åŒºåŸŸé€‰æ‹©
                districtSelect.innerHTML = '<option value="">è¯·é€‰æ‹©åŒºåŸŸ</option>';
                
                if (selectedCity) {
                    const districts = this.addressData[selectedProvince].cities[selectedCity].districts;
                    districtSelect.disabled = false;
                    
                    districts.forEach(district => {
                        const option = document.createElement('option');
                        option.value = district;
                        option.textContent = district;
                        districtSelect.appendChild(option);
                    });
                } else {
                    districtSelect.disabled = true;
                }
            }

            // æ”¶é›†è”ç³»äººä¿¡æ¯
            collectContacts() {
                this.collectFirstContact();
            }

            // æ”¶é›†ç¬¬ä¸€è”ç³»äººä¿¡æ¯
            collectFirstContact() {}

            // æ˜¾ç¤ºç¬¬ä¸€è”ç³»äººå…³ç³»é€‰æ‹©
           

            // è·å–å…³ç³»æ–‡æœ¬
            getRelationText(relation) {}

            // æ”¶é›†å•ä½ä¿¡æ¯
            collectCompanyInfo() {}

            // ä¿®æ”¹ validateAndSubmitCompanyInfo æ–¹æ³•ï¼Œæ·»åŠ é”™è¯¯å¤„ç†
            validateAndSubmitCompanyInfo() {}

            // ä¿®æ”¹ handleError æ–¹æ³•ï¼Œç¡®ä¿é”™è¯¯æç¤ºæ­£ç¡®æ˜¾ç¤º
            handleError(error) {
                console.error('Error:', error);
                chatManager.addSystemMessage(`
                    <div class="info-card error-card">
                        <div class="info-card-title">
                            <span>âš ï¸</span>
                            <span>æç¤º</span>
                        </div>
                        <div class="info-card-content">
                            ${error.message}
                        </div>
                    </div>
                `);
            }

            // ä¿®æ”¹æäº¤ä¿¡æ¯æ–¹æ³•ï¼Œå…ˆå±•ç¤ºç¡®è®¤é¡µ
            async submitAllInfo() {}

            

            // æ˜¾ç¤ºè´·å‰åè®®
            showAgreement() {}

            // å¼€å§‹è¯„ä¼°
            startEvaluation() {
                chatManager.addSystemMessage(`
                    <div class="info-card">
                        <div class="info-card-title">
                            <span>â³</span>
                            <span>ä¿¡æ¯è¯„ä¼°ä¸­</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-bar-fill" style="width: 0%"></div>
                        </div>
                        <div class="info-card-content">
                            æ­£åœ¨è¿›è¡Œæ™ºèƒ½è¯„ä¼°ï¼Œè¯·ç¨å€™...
                        </div>
                    </div>
                `);

                // æ¨¡æ‹Ÿè¿›åº¦æ¡
                let progress = 0;
                const interval = setInterval(() => {
                    progress += 20;
                    document.querySelector('.progress-bar-fill').style.width = `${progress}%`;
                    if (progress >= 100) {
                        clearInterval(interval);
                        this.showSubmitSuccess();
                    }
                }, 500);
            }

            // ä¿®æ”¹ showSubmitSuccess æ–¹æ³•ï¼Œæ·»åŠ å®¡æ ¸çŠ¶æ€åˆ¤æ–­
            async showSubmitSuccess() {
                // æ¨¡æ‹Ÿå®¡æ ¸ç»“æœï¼Œ80%é€šè¿‡ï¼Œ20%æ‹’ç»
                const isApproved = Math.random() > 0;
                
                if (isApproved) {
                    // åŸæœ‰çš„å®¡æ ¸é€šè¿‡é€»è¾‘
                    chatManager.addSystemMessage(`
                        <div class="info-card success-card">
                            <div class="info-card-title">
                                <span>ğŸ‰</span>
                                <span>è¯„ä¼°å®Œæˆ</span>
                            </div>
                            <div class="info-card-content">
                                æ­å–œæ‚¨ï¼åŸºäºæ‚¨æä¾›çš„ä¿¡æ¯ï¼Œå·²å®Œæˆæ™ºèƒ½è¯„ä¼°ï¼š
                                <div class="result-summary">
                                    <div class="result-item">
                                        <span class="label">âœ¨ æœ€é«˜å¯è´·é¢åº¦</span>
                                        <span class="value">80ä¸‡å…ƒ</span>
                                    </div>
                                    <div class="result-item">
                                        <span class="label">ğŸ’° å‚è€ƒæœˆåˆ©ç‡</span>
                                        <span class="value">0.35%èµ·</span>
                                    </div>
                                    <div class="result-item">
                                        <span class="label">â±ï¸ æœ€é•¿å€Ÿæ¬¾æœŸé™</span>
                                        <span class="value">36ä¸ªæœˆ</span>
                                    </div>
                                </div>
                            </div>
                            <div class="trust-badge">
                                <span>ğŸ’¡ å·²è·å¾—VIPé€šé“ï¼Œäº«å—ä¼˜å…ˆå®¡æ‰¹</span>
                            </div>
                            <div class="action-buttons">
                                <button class="action-button" onclick="loanApp.startWithdraw()">
                                    <span>ğŸ’°</span>
                                    <span>ç«‹å³æ”¯ç”¨</span>
                                </button>
                                <button class="action-button secondary" onclick="loanApp.showRepaymentPlan()">
                                    <span>ğŸ“Š</span>
                                    <span>æŸ¥çœ‹è¿˜æ¬¾æ–¹æ¡ˆ</span>
                                </button>
                            </div>
                        </div>
                    `);
                } else {
                    // æ–°å¢å®¡æ ¸æ‹’ç»é€»è¾‘
                    chatManager.addSystemMessage(`
                        
                    `);
                }
            }

            

            // æ·»åŠ ç«‹å³æ”¯ç”¨æ–¹æ³•
            startWithdraw() {
                chatManager.addSystemMessage(`
                    <div style="max-width:380px;margin:32px auto 0 auto;background:linear-gradient(180deg,#F6FAFF 0%,#FDFDFD 100%);border-radius:20px;box-shadow:0 4px 24px rgba(0,0,0,0.08);padding:0 0 20px 0;overflow:hidden;">
                        <div style="background:#fff;border-radius:16px;margin:0 16px 16px 16px;box-shadow:0 2px 8px rgba(0,0,0,0.03);padding:16px 12px 12px 12px;">
                            <div style="font-size:14px;color:#7F8C8D;">å€Ÿå¤šå°‘ <span style='font-size:12px;'>(å•ç¬”æœ€é«˜å¯å€Ÿï¿¥20,000)</span></div>
                            <div style="display:flex;align-items:flex-end;margin:8px 0 0 0;">
                                <span style="font-size:28px;font-weight:600;color:#00C853;">ï¿¥</span>
                                <input type="number" value="1000" min="1000" max="20000" style="border:none;outline:none;font-size:32px;font-weight:700;width:120px;color:#00C853;background:transparent;text-align:left;border-bottom:2px solid #00C853;" />
                            </div>
                            <div style="display:flex;gap:8px;margin:12px 0 0 0;">
                                <button style="flex:1;padding:6px 0;background:#E8F5E9;border:none;border-radius:8px;color:#00C853;font-size:15px;font-weight:500;box-shadow:0 1px 2px rgba(0,0,0,0.03);">å€Ÿ1åƒ</button>
                                <button style="flex:1;padding:6px 0;background:#E8F5E9;border:none;border-radius:8px;color:#00C853;font-size:15px;font-weight:500;box-shadow:0 1px 2px rgba(0,0,0,0.03);">å€Ÿ2åƒ</button>
                            </div>
                            <div style="font-size:12px;color:#A0AEC0;margin-top:4px;">å½“å‰å•ç¬”æœ€é«˜20,000å…ƒ</div>
                        </div>
                        <div style="margin:0 16px;">
                            <div style="padding:12px 0 8px 0;border-bottom:1px solid #F0F1F5;">
                                <div style="display:flex;align-items:center;justify-content:space-between;font-size:15px;">
                                <span>è¿˜æ¬¾æ–¹å¼</span>
                                    <span style='color:#00C853;display:flex;align-items:center;gap:2px;text-align:right;'>æŒ‰æœŸè¿˜ <span style='font-size:12px;color:#A0AEC0;'>(å¹´åˆ©ç‡çº¦20.41%)</span> <span style='font-size:16px;'>â€º</span></span>
                            </div>
                                <div style="display:flex;justify-content:flex-end;margin-top:4px;">
                                    <button onclick="loanApp.showRateComparisonModal()" style="padding:2px 10px;background:#F8FAFC;color:#00C853;border:1px solid #B2F2D7;border-radius:12px;font-size:12px;font-weight:500;cursor:pointer;box-shadow:none;height:26px;line-height:22px;vertical-align:middle;transition:all 0.2s;" onmouseover="this.style.borderColor='#00C853';this.style.background='#E5F9EF';" onmouseout="this.style.borderColor='#B2F2D7';this.style.background='#F8FAFC';">å¯¹æ¯”å…¶ä»–å¹³å°åˆ©ç‡</button>
                                </div>
                            </div>
                            <!-- è†¨èƒ€åˆ¸å±•ç¤ºè¡Œ 
                            <div style="display:flex;align-items:center;justify-content:space-between;padding:12px 0 12px 0;font-size:15px;border-bottom:1px solid #F0F1F5;background:rgba(0,200,83,0.06);">
                                <span>æç°è†¨èƒ€åˆ¸</span>
                                <span style="color:#FF5252;font-weight:600;">åˆ°è´¦é‡‘é¢+20å…ƒ </span>
                            </div>-->
                            <div style="display:flex;align-items:center;justify-content:space-between;padding:12px 0 12px 0;font-size:15px;border-bottom:1px solid #F0F1F5;">
                                <span>å€Ÿå¤šä¹… æ€ä¹ˆè¿˜</span>
                                <span style="color:#00C853;cursor:pointer;display:flex;align-items:center;gap:2px;">12æœŸ <span style='font-size:12px;color:#A0AEC0;'>é¦–æœŸ7æœˆ7æ—¥è¿˜æ¬¾ï¿¥93.79</span> <span style='font-size:16px;'>â€º</span></span>
                            </div>
                            <div style="display:flex;align-items:center;justify-content:space-between;padding:12px 0 0 0;font-size:15px;">
                                <span>æ”¶/è¿˜æ¬¾è´¦æˆ·</span>
                                <span style="color:#00C853;cursor:pointer;display:flex;align-items:center;gap:4px;"> <span style='font-size:18px;'>ğŸ¦</span>ä¸­å›½å»ºè®¾é“¶è¡Œ(5790) <span style='font-size:16px;'>â€º</span></span>
                            </div>
                        </div>
                        <div style="margin:18px 16px 0 16px;">
                            <div style="font-size:12px;color:#A0AEC0;margin:10px 0 0 0;">è¯·ç¡®è®¤æœ¬æ¬¡å€Ÿæ¬¾ç”¨äº <a href="#" style="color:#00C853;text-decoration:underline;">å…¶ä»–ä¸“æ¬¾ç”¨é€”</a>ï¼Œè¯·è°¨æ…å€Ÿæ¬¾ã€‚</div>
                        </div>
                        <div style="margin:28px 0 0 0;text-align:center;">
                            <button class="action-button" style="width:88%;font-size:17px;padding:14px 0;background:linear-gradient(90deg,#00C853,#6DD5FA);border:none;border-radius:24px;box-shadow:0 4px 16px rgba(10,200,83,0.10);font-weight:700;display:flex;justify-content:center;align-items:center;text-align:center;" onclick="loanApp.confirmWithdraw()">å»æç°</button>
                        </div>
                    </div>
                `);
            }

            // æ·»åŠ ç¡®è®¤æ”¯ç”¨æ–¹æ³•
            confirmWithdraw() {
                chatManager.addSystemMessage(`
                    <div class="info-card">
                        <div class="info-card-title">
                            <span>ğŸ‰</span>
                            <span>æ”¯ç”¨ç”³è¯·å·²æäº¤</span>
                        </div>
                        <div class="info-card-content">
                            <div class="success-info">
                                <p>æ‚¨çš„æ”¯ç”¨ç”³è¯·å·²å—ç†ï¼Œé¢„è®¡10åˆ†é’Ÿå†…åˆ°è´¦</p>
                                <div class="withdraw-info">
                                    <div class="info-item">
                                        <span class="label">æç°é‡‘é¢</span>
                                        <span class="value">1,000å…ƒ</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="label">è†¨èƒ€åˆ¸å¥–åŠ±</span>
                                        <span class="value" style="color:#FF5252;font-weight:600;">+20å…ƒ</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="label">åˆ°è´¦é‡‘é¢</span>
                                        <span class="value" style="color:#00C853;font-weight:600;">1,020å…ƒ</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="label">æ”¶æ¬¾è´¦æˆ·</span>
                                        <span class="value">å»ºè®¾é“¶è¡Œ(å°¾å·3568)</span>
                                    </div>
                                    <div class="info-item">
                                        <span class="label">é¢„è®¡åˆ°è´¦æ—¶é—´</span>
                                        <span class="value">10åˆ†é’Ÿå†…</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="trust-badge">
                            <span>ğŸ’ å·²å¼€å¯7å¤©å…æ¯ç‰¹æƒï¼Œè¯·åˆç†ä½¿ç”¨</span>
                        </div>
                        <div class="action-buttons">
                            <button class="action-button" onclick="loanApp.setupAutoRepayment()">
                                <span>âš™ï¸</span>
                                <span>è®¾ç½®è‡ªåŠ¨è¿˜æ¬¾</span>
                            </button>
                            <button class="action-button secondary" onclick="loanApp.checkProgress()">
                                <span>ğŸ“‹</span>
                                <span>æŸ¥çœ‹è¿›åº¦</span>
                            </button>
                        </div>
                    </div>
                `);
            }

            // é”™è¯¯å¤„ç†
            handleError(error) {
                console.error('Error:', error);
                chatManager.addSystemMessage(`
                    <div class="info-card error-card">
                        <div class="info-card-title">
                            <span>âš ï¸</span>
                            <span>æç¤º</span>
                        </div>
                        <div class="info-card-content">
                            ${error.message}
                        </div>
                    </div>
                `);
            }

            // æ£€æŸ¥é¢åº¦
            checkQuota() {
                chatManager.addSystemMessage(`
                    
                `);
            }

            // æŸ¥çœ‹è¿›åº¦
            checkProgress() {
                chatManager.addSystemMessage(`
                    <div class="info-card">
                        <div class="info-card-title">
                            <span>ğŸ“‹</span>
                            <span>ç”³è¯·è¿›åº¦è¿½è¸ª</span>
                        </div>
                        <div class="info-card-content">
                            <div style="margin-bottom: 16px;">
                                ç”³è¯·ç¼–å·ï¼š${this.applicationData.applyId}
                                <br>ç”³è¯·æ—¶é—´ï¼š${new Date().toLocaleString()}
                            </div>
                            
                            <div class="progress-steps">
                                <div class="progress-step completed">
                                    <div class="step-icon">âœ…</div>
                                    <div class="step-info">
                                        <div class="step-title">æäº¤ç”³è¯·</div>
                                        <div class="step-time">10:30</div>
                                    </div>
                                </div>
                                <div class="progress-step completed">
                                    <div class="step-icon">âœ…</div>
                                    <div class="step-info">
                                        <div class="step-title">å®åè®¤è¯</div>
                                        <div class="step-time">10:31</div>
                                    </div>
                                </div>
                                <div class="progress-step active">
                                    <div class="step-icon">â³</div>
                                    <div class="step-info">
                                        <div class="step-title">è‡ªåŠ¨å®¡æ ¸ä¸­</div>
                                        <div class="step-time">é¢„è®¡2åˆ†é’Ÿ</div>
                                    </div>
                                </div>
                                <div class="progress-step">
                                    <div class="step-icon">â­•ï¸</div>
                                    <div class="step-info">
                                        <div class="step-title">æ”¾æ¬¾ç¡®è®¤</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="trust-badge">
                            <span>âš¡ï¸ æ­£åœ¨åŠ é€Ÿå¤„ç†ä¸­ï¼Œè¯·ç¨å€™...</span>
                        </div>
                    </div>
                `);

                // æ¨¡æ‹Ÿ3ç§’åå®¡æ ¸é€šè¿‡
                setTimeout(() => this.showApprovalResult(), 3000);
            }

            // æ˜¾ç¤ºå®¡æ ¸ç»“æœ
            showApprovalResult() {
                chatManager.addSystemMessage(`
                    <div class="info-card">
                        <div class="info-card-title">
                            <span>ğŸ‰</span>
                            <span>å®¡æ ¸é€šè¿‡</span>
                        </div>
                        <div class="info-card-content">
                            æ­å–œæ‚¨ï¼è´·æ¬¾ç”³è¯·å·²å®¡æ ¸é€šè¿‡
                            <br><br>
                            <div class="approval-details">
                                <div class="detail-item">
                                    <div class="detail-label">å®¡æ‰¹é¢åº¦</div>
                                    <div class="detail-value">50,000å…ƒ</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">å¹´åŒ–åˆ©ç‡</div>
                                    <div class="detail-value">3.6%èµ·</div>
                                </div>
                                <div class="detail-item">
                                    <div class="detail-label">å¯é€‰æœŸé™</div>
                                    <div class="detail-value">3-36ä¸ªæœˆ</div>
                                </div>
                            </div>
                            
                            <div class="loan-calculator">
                                <div class="calculator-title">
                                    <span>ğŸ’¡</span>
                                    <span>è¿˜æ¬¾è®¡ç®—</span>
                                </div>
                                <div class="calculator-content">
                                    Â· å€Ÿæ¬¾é‡‘é¢ï¼š50,000å…ƒ
                                    <br>Â· å€Ÿæ¬¾æœŸé™ï¼š12ä¸ªæœˆ
                                    <br>Â· æ¯æœˆè¿˜æ¬¾ï¼šçº¦4,287å…ƒ
                                    <br>Â· æ€»åˆ©æ¯ï¼šçº¦1,444å…ƒ
                                </div>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button class="action-button" onclick="loanApp.startLoanConfirmation()">
                                <span>ğŸ’°</span>
                                <span>ç¡®è®¤æ”¾æ¬¾</span>
                            </button>
                            <button class="action-button secondary" onclick="loanApp.adjustLoanTerms()">
                                <span>âš™ï¸</span>
                                <span>è°ƒæ•´æ–¹æ¡ˆ</span>
                            </button>
                        </div>
                    </div>
                `);
            }

            // å¼€å§‹æ”¾æ¬¾ç¡®è®¤
            startLoanConfirmation() {
                chatManager.addSystemMessage(`
                    <div class="info-card">
                        <div class="info-card-title">
                            <span>ğŸ“</span>
                            <span>æ”¾æ¬¾ç¡®è®¤</span>
                        </div>
                        <div class="info-card-content">
                            è¯·ç¡®è®¤ä»¥ä¸‹æ”¾æ¬¾ä¿¡æ¯ï¼š
                            
                            <div class="confirmation-details">
                                <div class="detail-group">
                                    <div class="group-title">å€Ÿæ¬¾ä¿¡æ¯</div>
                                    <div class="group-content">
                                        Â· å€Ÿæ¬¾é‡‘é¢ï¼š50,000å…ƒ
                                        <br>Â· å€Ÿæ¬¾æœŸé™ï¼š12ä¸ªæœˆ
                                        <br>Â· æ¯æœˆè¿˜æ¬¾æ—¥ï¼šæ¯æœˆ10æ—¥
                                        <br>Â· é¦–æ¬¡è¿˜æ¬¾æ—¥ï¼š2024å¹´5æœˆ10æ—¥
                                    </div>
                                </div>
                                
                                <div class="detail-group">
                                    <div class="group-title">æ”¶æ¬¾è´¦æˆ·</div>
                                    <div class="group-content">
                                        Â· å¼€æˆ·åï¼šå¼ **
                                        <br>Â· é“¶è¡Œï¼šå»ºè®¾é“¶è¡Œ
                                        <br>Â· å¡å·ï¼š6217 **** **** 3568
                                    </div>
                                </div>
                                
                                <div class="detail-group">
                                    <div class="group-title">æ¸©é¦¨æç¤º</div>
                                    <div class="group-content">
                                        Â· é¢„è®¡10åˆ†é’Ÿå†…åˆ°è´¦
                                        <br>Â· è¯·ç¡®ä¿è´¦æˆ·å¯æ­£å¸¸æ”¶æ¬¾
                                        <br>Â· é¦–æœŸè¿˜æ¬¾å°†è‡ªåŠ¨æ‰£æ¬¾
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="trust-badge">
                            <span>ğŸ æ–°ç”¨æˆ·ä¸“äº«7å¤©å…æ¯ç‰¹æƒå·²è‡ªåŠ¨åŠ å…¥</span>
                        </div>
                        <div class="action-buttons">
                            <button class="action-button" onclick="loanApp.confirmLoan()">
                                <span>âœ…</span>
                                <span>ç¡®è®¤æ”¾æ¬¾</span>
                            </button>
                            <button class="action-button secondary" onclick="loanApp.modifyAccount()">
                                <span>ğŸ“</span>
                                <span>ä¿®æ”¹è´¦æˆ·</span>
                            </button>
                        </div>
                    </div>
                `);
            }

            // ç¡®è®¤æ”¾æ¬¾
            confirmLoan() {
                chatManager.addSystemMessage(`
                    <div class="info-card">
                        <div class="info-card-title">
                            <span>ğŸ’«</span>
                            <span>æ”¾æ¬¾å¤„ç†ä¸­</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-bar-fill" style="width: 0%"></div>
                        </div>
                        <div class="info-card-content">
                            æ­£åœ¨ä¸ºæ‚¨åŠ é€Ÿå¤„ç†æ”¾æ¬¾ï¼Œè¯·ç¨å€™...
                        </div>
                    </div>
                `);

                // æ¨¡æ‹Ÿæ”¾æ¬¾è¿›åº¦
                let progress = 0;
                const interval = setInterval(() => {
                    progress += 20;
                    document.querySelector('.progress-bar-fill').style.width = `${progress}%`;
                    if (progress >= 100) {
                        clearInterval(interval);
                        this.showLoanSuccess();
                    }
                }, 500);
            }

            // æ˜¾ç¤ºæ”¾æ¬¾æˆåŠŸ
            showLoanSuccess() {
                chatManager.addSystemMessage(`
                    <div class="info-card">
                        <div class="info-card-title">
                            <span>ğŸ‰</span>
                            <span>æ”¾æ¬¾æˆåŠŸ</span>
                        </div>
                        <div class="info-card-content">
                            æ‚¨çš„è´·æ¬¾å·²æˆåŠŸå‘æ”¾ï¼
                            
                            <div class="loan-details">
                                <div class="detail-group">
                                    <div class="group-title">äº¤æ˜“ä¿¡æ¯</div>
                                    <div class="group-content">
                                        Â· äº¤æ˜“é‡‘é¢ï¼š50,000å…ƒ
                                        <br>Â· äº¤æ˜“æµæ°´ï¼š${this.applicationData.applyId}
                                        <br>Â· é¢„è®¡åˆ°è´¦ï¼š5-10åˆ†é’Ÿ
                                    </div>
                                </div>
                                
                                <div class="detail-group">
                                    <div class="group-title">è¿˜æ¬¾æé†’</div>
                                    <div class="group-content">
                                        Â· é¦–æ¬¡è¿˜æ¬¾æ—¥ï¼š2024å¹´5æœˆ10æ—¥
                                        <br>Â· æ¯æœˆè¿˜æ¬¾ï¼š4,287å…ƒ
                                        <br>Â· æ¸©é¦¨æç¤ºï¼šå°†äºè¿˜æ¬¾æ—¥å‰3å¤©æé†’
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button class="action-button" onclick="loanApp.viewRepaymentPlan()">
                                <span>ğŸ“…</span>
                                <span>æŸ¥çœ‹è¿˜æ¬¾è®¡åˆ’</span>
                            </button>
                            <button class="action-button secondary" onclick="loanApp.setupAutoRepayment()">
                                <span>âš™ï¸</span>
                                <span>è®¾ç½®è‡ªåŠ¨è¿˜æ¬¾</span>
                            </button>
                        </div>
                    </div>
                `);
            }

            // æŸ¥çœ‹è¿˜æ¬¾è®¡åˆ’
            viewRepaymentPlan() {}

            // è®¾ç½®è‡ªåŠ¨è¿˜æ¬¾
            setupAutoRepayment() {}

            // éªŒè¯è”ç³»äººå§“å
            validateContactName(input) {}

            // éªŒè¯è”ç³»äººæ‰‹æœºå·
            validateContactPhone(input) {}

            // æ˜¾ç¤ºç™»å½•ç•Œé¢
            showLogin() {}

            // å‘é€éªŒè¯ç 
            async sendVerifyCode() {}

            // éªŒè¯éªŒè¯ç 
            async verifyCode(code) {
                if (!/^\d{6}$/.test(code)) {
                    this.handleError(new Error('è¯·è¾“å…¥6ä½æ•°å­—éªŒè¯ç '));
                    return;
                }

                // æ¨¡æ‹ŸéªŒè¯è¿‡ç¨‹
                chatManager.addSystemMessage(`
                    <div class="info-card">
                        <div class="info-card-title">
                            <span>ğŸ”„</span>
                            <span>éªŒè¯ä¸­...</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-bar-fill" style="width: 0%"></div>
                        </div>
                    </div>
                `);

                // æ¨¡æ‹ŸéªŒè¯å»¶è¿Ÿ
                setTimeout(() => {
                    this.handleLoginSuccess();
                }, 1500);
            }

            // å¤„ç†ç™»å½•æˆåŠŸ
            handleLoginSuccess() {}

            // æ·»åŠ è¿”å›ä¿®æ”¹æ–¹æ³•
            editInfo() {
                // è¿”å›åˆ°å•ä½ä¿¡æ¯å¡«å†™é¡µé¢
                this.collectCompanyInfo();
            }

            // æ·»åŠ æŸ¥çœ‹å®Œæ•´åè®®æ–¹æ³•
            viewFullAgreement() {}

            // è®¡ç®—ä¼˜æƒ æ€»ä»·å€¼
            calculateTotalBenefits() {
                let total = 0;
                
                // è®¡ç®—ä¼˜æƒ åˆ¸ä»·å€¼
                this.benefits.coupons.forEach(coupon => {
                    total += coupon.value;
                });
                
                // è®¡ç®—æŠ½å¥–æœŸæœ›ä»·å€¼
                total += this.benefits.luckyDraw.value * this.benefits.luckyDraw.probability;
                
                // è®¡ç®—ç­¾åˆ°å¥–åŠ±
                total += this.benefits.checkIn.value;
                
                // è®¡ç®—çº¢åŒ…æœŸæœ›ä»·å€¼
                total += this.benefits.redPacket.value;
                
                return total;
            }

            // è®¡ç®—å®é™…IRR
            calculateActualIRR(loanAmount, term, originalIRR) {
                const totalBenefits = this.calculateTotalBenefits();
                const monthlyPayment = this.calculateMonthlyPayment(loanAmount, term, originalIRR);
                const totalPayment = monthlyPayment * term;
                const actualPayment = totalPayment - totalBenefits;
                
                // ä½¿ç”¨ç®€åŒ–å…¬å¼è®¡ç®—å®é™…IRR
                return (actualPayment / loanAmount - 1) / (term / 12);
            }

            // è®¡ç®—æœˆä¾›
            calculateMonthlyPayment(amount, term, irr) {
                const monthlyRate = irr / 12;
                return amount * monthlyRate * Math.pow(1 + monthlyRate, term) / (Math.pow(1 + monthlyRate, term) - 1);
            }

            // æ˜¾ç¤ºä¼˜æƒ ä»·å€¼è½¬æ¢
            showBenefitsConversion() {
                const totalBenefits = this.calculateTotalBenefits();
                
                chatManager.addSystemMessage(`
                    <div class="info-card">
                        <div class="info-card-title">
                            <span>ğŸ</span>
                            <span>ä¸“å±ä¼˜æƒ ä»·å€¼</span>
                        </div>
                        <div class="benefits-section">
                            <div class="benefits-list">
                                <div class="benefit-item">
                                    <div class="benefit-icon">ğŸ«</div>
                                    <div class="benefit-info">
                                        <div class="benefit-name">ä¼˜æƒ åˆ¸</div>
                                        <div class="benefit-value">Â¥350</div>
                                    </div>
                                </div>
                                <div class="benefit-item">
                                    <div class="benefit-icon">ğŸ²</div>
                                    <div class="benefit-info">
                                        <div class="benefit-name">æŠ½å¥–æ´»åŠ¨</div>
                                        <div class="benefit-value">Â¥500</div>
                                    </div>
                                </div>
                                <div class="benefit-item">
                                    <div class="benefit-icon">ğŸ“…</div>
                                    <div class="benefit-info">
                                        <div class="benefit-name">ç­¾åˆ°å¥–åŠ±</div>
                                        <div class="benefit-value">Â¥50</div>
                                    </div>
                                </div>
                                <div class="benefit-item">
                                    <div class="benefit-icon">ğŸ§§</div>
                                    <div class="benefit-info">
                                        <div class="benefit-name">çº¢åŒ…æ´»åŠ¨</div>
                                        <div class="benefit-value">Â¥10</div>
                                    </div>
                                </div>
                            </div>
                            <div class="total-benefits">
                                <div>ä¼˜æƒ æ€»ä»·å€¼</div>
                                <div class="total-value">Â¥${totalBenefits}</div>
                                <div>å¯ç”¨äºæŠµæ‰£åˆ©æ¯</div>
                            </div>
                        </div>
                    </div>
                `);
            }

            // æ˜¾ç¤ºç«å“å¯¹æ¯”
            showCompetitorComparison() {
                const ourIRR = 0.10; // æˆ‘ä»¬çš„åŸºç¡€IRR
                const actualIRR = this.calculateActualIRR(50000, 12, ourIRR);
                
                chatManager.addSystemMessage(`
                    <div class="info-card">
                        <div class="info-card-title">
                            <span>ğŸ“Š</span>
                            <span>åˆ©ç‡å¯¹æ¯”</span>
                        </div>
                        <div class="comparison-section">
                            <table class="comparison-table">
                                <thead>
                                    <tr>
                                        <th>å¹³å°</th>
                                        <th>ä¼˜æƒ å‰ç»¼åˆIRR</th>
                                        <th>ä¼˜æƒ åç»¼åˆIRR</th>
                                        <th>æ”¾æ¬¾</th>
                                        <th>ç‰¹è‰²</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="highlight">
                                        <td>æœ¬å¹³å°</td>
                                        <td>${(ourIRR * 100).toFixed(1)}%</td>
                                        <td class="better">${(actualIRR * 100).toFixed(1)}% <span class='irr-qmark' title='æŸ¥çœ‹è®¡ç®—è¿‡ç¨‹' onclick='window.showIRRDetailModal()'>?</span></td>
                                        <td class="better">3åˆ†é’Ÿ</td>
                                        <td>å†…éƒ¨å‘˜å·¥ä¸“äº«æé€Ÿæ”¾æ¬¾</td>
                                    </tr>
                                    ${this.competitors.map(comp => `
                                        <tr>
                                            <td>${comp.name}</td>
                                            <td>${(comp.irr * 100).toFixed(1)}%</td>
                                            <td>${(comp.irr * 100).toFixed(1)}%</td>
                                            <td>24å°æ—¶</td>
                                            <td>${comp.features.join('ã€')}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        <div class="trust-badge">
                            <span>ğŸ’¡ å†…éƒ¨å‘˜å·¥ä¸“äº«ï¼Œä¼˜æƒ åå®é™…åˆ©ç‡æ›´ä½ï¼Œæé€Ÿæ”¾æ¬¾æœåŠ¡</span>
                        </div>
                        <div class="action-buttons">
                            <button class="action-button" onclick="loanApp.startWithdraw()">
                                <span>ğŸ‘‰</span>
                                <span>ç«‹å³æç°</span>
                            </button>
                            <button class="action-button secondary" onclick="loanApp.showBenefitCalculator()">
                                <span>ğŸ§®</span>
                                <span>è¯•ç®—ä¼˜æƒ </span>
                            </button>
                        </div>
                    </div>
                `);
            }

            // ä¸»åŠ¨æ¨é€ä¼˜æƒ é€šçŸ¥
            showActivePromotions() {
                chatManager.addSystemMessage(`
                    <div class="info-card promotion-card">
                        <div class="info-card-title">
                            <span>ğŸ‰</span>
                            <span>ä¸“å±ä¼˜æƒ å·²åˆ°è´¦</span>
                        </div>
                        <div class="promotion-list">
                            ${this.activePromotions.map(promo => `
                                <div class="promotion-item" onclick="loanApp.showPromotionDetail(${promo.id})">
                                    <div class="promotion-icon">${promo.icon}</div>
                                    <div class="promotion-info">
                                        <div class="promotion-title">${promo.title}</div>
                                        <div class="promotion-desc">${promo.description}</div>
                                    </div>
                                    <div class="promotion-arrow">â†’</div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="action-buttons">
                            <button class="action-button" onclick="loanApp.showBenefitCalculator()">
                                <span>ğŸ§®</span>
                                <span>è¯•ç®—ä¼˜æƒ </span>
                            </button>
                            <button class="action-button secondary" onclick="loanApp.showCouponWallet()">
                                <span>ğŸ«</span>
                                <span>æŸ¥çœ‹å¡åŒ…</span>
                            </button>
                        </div>
                    </div>
                `);
            }

            // æ˜¾ç¤ºä¼˜æƒ è¯¦æƒ…
            showPromotionDetail(promoId) {
                const promo = this.activePromotions.find(p => p.id === promoId);
                if (!promo) return;

                chatManager.addSystemMessage(`
                    <div class="info-card">
                        <div class="info-card-title">
                            <span>${promo.icon}</span>
                            <span>${promo.title}</span>
                        </div>
                        <div class="info-card-content">
                            <div class="promotion-detail">
                                <div class="detail-value">Â¥${promo.value}</div>
                                <div class="detail-desc">${promo.description}</div>
                                <div class="detail-rules">
                                    <h4>ä½¿ç”¨è§„åˆ™ï¼š</h4>
                                    <ul>
                                        <li>ä»…é™é¦–ç¬”è´·æ¬¾ä½¿ç”¨</li>
                                        <li>ä¸å¯ä¸å…¶ä»–ä¼˜æƒ åŒæ—¶ä½¿ç”¨</li>
                                        <li>æœ‰æ•ˆæœŸè‡³2024å¹´12æœˆ31æ—¥</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button class="action-button" onclick="loanApp.showBenefitCalculator()">
                                <span>ğŸ§®</span>
                                <span>ç«‹å³ä½¿ç”¨</span>
                            </button>
                        </div>
                    </div>
                `);
            }

            // æ˜¾ç¤ºä¼˜æƒ è®¡ç®—å™¨
            showBenefitCalculator() {
                chatManager.addSystemMessage(`
                    <div class="info-card">
                        <div class="info-card-title">
                            <span>ğŸ§®</span>
                            <span>ä¼˜æƒ è¯•ç®—</span>
                        </div>
                        <div class="calculator-section">
                            <div class="form-group">
                                <label>å€Ÿæ¬¾é‡‘é¢</label>
                                <input type="number" name="calcAmount" 
                                       placeholder="è¯·è¾“å…¥å€Ÿæ¬¾é‡‘é¢" 
                                       max="800000" required>
                            </div>
                            <div class="form-group">
                                <label>å€Ÿæ¬¾æœŸé™</label>
                                <select name="calcTerm" required>
                                    <option value="">è¯·é€‰æ‹©æœŸé™</option>
                                    <option value="12">12ä¸ªæœˆ</option>
                                    <option value="24">24ä¸ªæœˆ</option>
                                    <option value="36">36ä¸ªæœˆ</option>
                                </select>
                            </div>
                            <div class="selected-benefits">
                                <div class="benefits-title">å·²é€‰ä¼˜æƒ </div>
                                <div class="benefits-list">
                                    ${this.activePromotions.map(promo => `
                                        <div class="benefit-tag">
                                            <span>${promo.icon}</span>
                                            <span>${promo.title}</span>
                                            <span class="benefit-value">Â¥${promo.value}</span>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                        <div class="action-buttons">
                            <button class="action-button" onclick="loanApp.calculateAndCompare()">
                                <span>ğŸ“Š</span>
                                <span>è®¡ç®—å¯¹æ¯”</span>
                            </button>
                        </div>
                    </div>
                `);
            }

            // è®¡ç®—å¹¶å¯¹æ¯”
            calculateAndCompare() {
                const amount = document.querySelector('input[name="calcAmount"]').value;
                const term = document.querySelector('select[name="calcTerm"]').value;
                
                if (!amount || !term) {
                    this.handleError(new Error('è¯·å¡«å†™å®Œæ•´çš„å€Ÿæ¬¾ä¿¡æ¯'));
                    return;
                }

                const ourIRR = 0.10; // åŸºç¡€IRR
                const actualIRR = this.calculateActualIRR(parseInt(amount), parseInt(term), ourIRR);
                const isBetter = actualIRR < Math.min(...this.competitors.map(c => c.irr));

                chatManager.addSystemMessage(`
                    <div class="info-card">
                        <div class="info-card-title">
                            <span>ğŸ“Š</span>
                            <span>åˆ©ç‡å¯¹æ¯”</span>
                        </div>
                        <div class="comparison-section">
                            <table class="comparison-table">
                                <thead>
                                    <tr>
                                        <th>å¹³å°</th>
                                        <th>ä¼˜æƒ åˆ¸ç»¼åˆIRR</th>
                                        <th>ä¼˜æƒ åç»¼åˆIRR</th>
                                        <th>æ”¾æ¬¾</th>
                                        <th>ç‰¹è‰²</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="highlight">
                                        <td>æœ¬å¹³å°</td>
                                        <td>18%</td>
                                        <td class="better">${(actualIRR * 100).toFixed(1)}% <span class='irr-qmark' title='æŸ¥çœ‹è®¡ç®—è¿‡ç¨‹' onclick='window.showIRRDetailModal()'>?</span></td>
                                        <td class="better">5åˆ†é’Ÿ</td>
                                        <td>å†…éƒ¨å‘˜å·¥ä¸“äº«æé€Ÿæ”¾æ¬¾</td>
                                    </tr>
                                    ${this.competitors.map(comp => `
                                        <tr>
                                            <td>${comp.name}</td>
                                            <td>${(comp.irr * 100).toFixed(1)}%</td>
                                            <td>${(comp.irr * 100).toFixed(1)}%</td>
                                            <td>24å°æ—¶</td>
                                            <td>${comp.features.join('ã€')}</td>
                                        </tr>
                                    `).join('')}
                                </tbody>
                            </table>
                        </div>
                        <div class="trust-badge">
                            <span>ğŸ’¡ å†…éƒ¨å‘˜å·¥ä¸“äº«ï¼Œä¼˜æƒ åå®é™…åˆ©ç‡æ›´ä½ï¼Œæé€Ÿæ”¾æ¬¾æœåŠ¡</span>
                        </div>
                    </div>
                `);
            }

            // æ˜¾ç¤ºä¼˜æƒ åˆ¸å¡åŒ…
            showCouponWallet() {
                chatManager.addSystemMessage(`
                    <div class="info-card">
                        <div class="info-card-title">
                            <span>ğŸ«</span>
                            <span>æˆ‘çš„ä¼˜æƒ åˆ¸</span>
                        </div>
                        <div class="coupon-list">
                            ${this.activePromotions.map(promo => `
                                <div class="coupon-item" onclick="loanApp.showPromotionDetail(${promo.id})">
                                    <div class="coupon-icon">${promo.icon}</div>
                                    <div class="coupon-info">
                                        <div class="coupon-name">${promo.title}</div>
                                        <div class="coupon-desc">${promo.description}</div>
                                    </div>
                                    <div class="coupon-value">Â¥${promo.value}</div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="action-buttons">
                            <button class="action-button" onclick="loanApp.showBenefitCalculator()">
                                <span>ğŸ§®</span>
                                <span>ä½¿ç”¨ä¼˜æƒ </span>
                            </button>
                        </div>
                    </div>
                `);
            }

            // æ·»åŠ å¤©é™å¤§ç¤¼åŒ…ç›¸å…³æ–¹æ³•
            showGiftPackage() {
                const ourIRR = 0.18; // æˆ‘ä»¬çš„åŸºç¡€IRR
                const actualIRR = this.calculateActualIRR(50000, 12, ourIRR);
                
                const modal = document.createElement('div');
                modal.className = 'gift-package-modal';
                modal.innerHTML = `
                    <div class="gift-package-content">
                        <div class="gift-package-header">
                            <div class="gift-package-close" onclick="this.parentElement.parentElement.parentElement.remove()">Ã—</div>
                            <div class="gift-package-title">åˆ©ç‡å¯¹æ¯”</div>
                            <div class="gift-package-subtitle">å¤šå®¶å¹³å°åˆ©ç‡å¯¹æ¯”</div>
                        </div>
                        <div class="gift-package-body">
                            <div class="comparison-section">
                                <table class="comparison-table">
                                    <thead>
                                        <tr>
                                            <th>å¹³å°åç§°</th>
                                            <th>ä¼˜æƒ å‰ç»¼åˆIRR</th>
                                            <th>ä¼˜æƒ åç»¼åˆIRR</th>
                                            <th>æ”¾æ¬¾æ—¶é—´</th>
                                           <!--<th>ç‰¹è‰²</th> --> 
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="highlight">
                                            <td>æœ¬å¹³å°</td>
                                            <td>${(ourIRR * 100).toFixed(1)}%</td>
                                            <td class="better">${(actualIRR * 100).toFixed(1)}% <span class='irr-qmark' title='æŸ¥çœ‹è®¡ç®—è¿‡ç¨‹' onclick='window.showIRRDetailModal()'>?</span></td>
                                            <td class="better">3åˆ†é’Ÿ</td>
                                           <!-- <td>å†…éƒ¨å‘˜å·¥ä¸“äº«æé€Ÿæ”¾æ¬¾</td> -->
                                        </tr>
                                        ${this.competitors.map(comp => `
                                            <tr>
                                                <td>${comp.name}</td>
                                                <td>${(comp.irr * 100).toFixed(1)}%</td>
                                                <td>${(comp.irr * 100).toFixed(1)}%</td>
                                                <td>24å°æ—¶</td>
                                            <!--    <td>${comp.features.join('ã€')}</td> -->
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                            <div class="trust-badge">
                                <span>ğŸ’¡ å†…éƒ¨å‘˜å·¥ä¸“äº«ï¼Œä¼˜æƒ åå®é™…åˆ©ç‡æ›´ä½ï¼Œæé€Ÿæ”¾æ¬¾æœåŠ¡</span>
                            </div>
                            <div class="action-buttons">
                                <button class="action-button" onclick="loanApp.startApplication()">
                                    <span>ğŸ‘‰</span>
                                    <span>ç«‹å³æç°</span>
                                </button>
                                <button class="action-button secondary" onclick="loanApp.showBenefitCalculator()">
                                    <span>ğŸ§®</span>
                                    <span>è¯•ç®—ä¼˜æƒ </span>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }

            // æ·»åŠ æ–°çš„æ´»åŠ¨å‚ä¸æ–¹æ³•
            claimCoupon(type) {
                // ç§»é™¤ç¤¼åŒ…å¼¹çª—
                document.querySelector('.gift-package-modal').remove();
                
                // æ˜¾ç¤ºé¢†å–æˆåŠŸæ¶ˆæ¯
                chatManager.addSystemMessage(`
                    <div class="info-card success-card">
                        <div class="info-card-title">
                            <span>ğŸ‰</span>
                            <span>é¢†å–æˆåŠŸ</span>
                        </div>
                        <div class="info-card-content">
                            æ­å–œæ‚¨æˆåŠŸé¢†å–3æœŸå…æ¯åˆ¸ï¼
                            <br>ä¼˜æƒ åˆ¸å·²å­˜å…¥æ‚¨çš„è´¦æˆ·
                        </div>
                        <div class="trust-badge">
                            <span>ğŸ’ ä¼˜æƒ åˆ¸å°†åœ¨æ‚¨æç°æ—¶è‡ªåŠ¨ä½¿ç”¨</span>
                        </div>
                        <div class="action-buttons">
                            <button class="action-button" onclick="loanApp.startWithdraw()">
                                <span>ğŸš€</span>
                                <span>ç«‹å³ä½¿ç”¨</span>
                            </button>
                            <button class="action-button secondary" onclick="loanApp.showCouponWallet()">
                                <span>ğŸ«</span>
                                <span>æŸ¥çœ‹å¡åŒ…</span>
                            </button>
                        </div>
                    </div>
                `);
            }

            

            joinLuckyDraw() {
                // ç§»é™¤ç¤¼åŒ…å¼¹çª—
                document.querySelector('.gift-package-modal').remove();
                
                // æ˜¾ç¤ºæŠ½å¥–æ´»åŠ¨é¡µé¢
                chatManager.addSystemMessage()
            }

            goToCheckIn() {
                // ç§»é™¤ç¤¼åŒ…å¼¹çª—
                document.querySelector('.gift-package-modal').remove();
                
                // æ˜¾ç¤ºç­¾åˆ°é¡µé¢
                chatManager.addSystemMessage()
            }

            // æ–°å¢ showRateComparisonModal æ–¹æ³•
            showRateComparisonModal() {
                // å…ˆç§»é™¤å·²å­˜åœ¨çš„modal
                const old = document.querySelector('.gift-package-modal');
                if (old) old.remove();
                const ourIRR = 0.10;
                const actualIRR = this.calculateActualIRR(50000, 12, ourIRR);
                const modal = document.createElement('div');
                modal.className = 'gift-package-modal';
                modal.innerHTML = `
                    <div class="gift-package-content">
                        <div class="gift-package-header">
                            <div class="gift-package-close" onclick="document.querySelector('.gift-package-modal').remove();loanApp.startWithdraw();">Ã—</div>
                            <div class="gift-package-title">åˆ©ç‡å¯¹æ¯”</div>
                            <div class="gift-package-subtitle">å¤šå®¶å¹³å°åˆ©ç‡å¯¹æ¯”</div>
                        </div>
                        <div class="gift-package-body">
                            <div class="comparison-section">
                                <table class="comparison-table">
                                    <thead>
                                        <tr>
                                            <th>å¹³å°</th>
                                            <th>åŸºç¡€IRR</th>
                                            <th>ä¼˜æƒ å</th>
                                            <th>æ”¾æ¬¾</th>
                                            <th>ç‰¹è‰²</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr class="highlight">
                                            <td>æœ¬å¹³å°</td>
                                            <td>${(ourIRR * 100).toFixed(1)}%</td>
                                            <td class="better">${(actualIRR * 100).toFixed(1)}% <span class='irr-qmark' title='æŸ¥çœ‹è®¡ç®—è¿‡ç¨‹' onclick='window.showIRRDetailModal()'>?</span></td>
                                            <td class="better">3åˆ†é’Ÿ</td>
                                            <td>å†…éƒ¨å‘˜å·¥ä¸“äº«æé€Ÿæ”¾æ¬¾</td>
                                        </tr>
                                        ${this.competitors.map(comp => `
                                            <tr>
                                                <td>${comp.name}</td>
                                                <td>${(comp.irr * 100).toFixed(1)}%</td>
                                                <td>${(comp.irr * 100).toFixed(1)}%</td>
                                                <td>24å°æ—¶</td>
                                                <td>${comp.features.join('ã€')}</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                            <div class="trust-badge">
                                <span>ğŸ’¡ å†…éƒ¨å‘˜å·¥ä¸“äº«ï¼Œä¼˜æƒ åå®é™…åˆ©ç‡æ›´ä½ï¼Œæé€Ÿæ”¾æ¬¾æœåŠ¡</span>
                            </div>
                            <div class="action-buttons">
                                <button class="action-button" onclick="loanApp.startApplication()">
                                    <span>ğŸ‘‰</span>
                                    <span>ç«‹å³ç”³è¯·</span>
                                </button>
                                <button class="action-button secondary" onclick="loanApp.showBenefitCalculator()">
                                    <span>ğŸ§®</span>
                                    <span>è¯•ç®—ä¼˜æƒ </span>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                document.body.appendChild(modal);
            }

            showBestDealsPage() {
                // æ´»åŠ¨ä¸åˆ¸æ•°æ®
                const activities = [
                    { name: 'æœˆä¸­æŠ½é»„é‡‘', desc: 'æœˆä¸­æŠ½å¥–ï¼Œæœ€é«˜1gå®ç‰©é»„é‡‘', value: 1.92, icon: 'ğŸ¥‡' },
                    { name: 'å‘¨ä¸‰æŠ¢åˆ¸', desc: 'æ¯å‘¨ä¸‰é™é‡æŠ¢åˆ¸', value: 10, icon: 'ğŸ«' },
                    { name: 'å¤©å¤©ç­¾åˆ°', desc: 'æ¯æ—¥ç­¾åˆ°å¥–åŠ±', value: 5, icon: 'ğŸ“…' },
                    { name: 'ç“œåˆ†æ´»åŠ¨', desc: 'å‚ä¸åˆ†å¥–é‡‘', value: 2.88, icon: 'ğŸ' },
                    { name: 'åå‘¨å¹´æŠ½å¥–', desc: 'åå‘¨å¹´æŠ½å¥–ï¼Œæœ€é«˜999å…ƒ', value: 5, icon: 'ğŸ²' },
                    { name: 'å®ˆä¿¡è¿”ç°', desc: 'å®ˆä¿¡ç”¨æˆ·ä¸“äº«è¿”ç°', value: 28, icon: 'ğŸ’' },
                ];
                const coupons = [
                    { name: '3æœŸå…æ¯åˆ¸', desc: '3æœŸå…æ¯ï¼Œæœ€é«˜å‡å…100å…ƒ', value: 3, type: 'period', valid: '2025.06.19è‡³2025.09.25', icon: 'ğŸ¯' },
                    { name: '7æŠ˜åˆ©ç‡åˆ¸', desc: '7æŠ˜åˆ©ç‡ï¼Œæœ€é«˜å‡å…200å…ƒ', value: 7, type: 'discount', valid: '2025.06.19è‡³2025.12.31', icon: 'ğŸ’°' },
                    { name: '10å…ƒæŠµæ‰£åˆ¸', desc: 'æŠµæ‰£é‡‘é¢ï¼š10å…ƒ', value: 10, type: 'money', valid: '2025.06.19è‡³2025.12.31', icon: 'ğŸ’µ' },
                ];
                const products = [
                    { name: '2500å…ƒ3æœŸæœˆæ¯1å…ƒ', desc: '2500å…ƒ3æœŸæœˆæ¯1å…ƒç‰¹æƒ', value: 3, type: 'special', valid: '2025.06.19è‡³2025.12.31', icon: 'âš¡' },
                    { name: '8æŠ˜æƒç›Š', desc: '8æŠ˜åˆ©ç‡ç‰¹æƒ', value: 8, type: 'discount', valid: '2025.06.19è‡³2025.12.31', icon: 'ğŸ†' },
                ];
                const totalValue = activities.reduce((sum, d) => sum + d.value, 0) + coupons.reduce((sum, d) => sum + (d.type==='money'?d.value:0), 0) + products.reduce((sum, d) => sum + (d.type==='special'?d.value:0), 0);
                
                // é¡µé¢HTML - é‡æ–°è®¾è®¡ï¼Œä¸‰ä¸ªæ ¸å¿ƒæ¨¡å—ç´§å¯†æ’åˆ—
                document.querySelector('.chat-container').innerHTML = `
                    <div style="padding:20px 0 0 0;background:linear-gradient(180deg,#F8FAFC 0%,#FFFFFF 100%);min-height:100vh;">
                        <!-- é¡µé¢æ ‡é¢˜ -->
                        <div style="text-align:center;margin-bottom:24px;">
                            <div style="font-size:24px;font-weight:800;background:linear-gradient(135deg,#00C853,#1976FF);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:8px;">é†‰åˆ’ç®—æ”»ç•¥</div>
                            <div style="font-size:14px;color:#7F8C8D;">ä¸“å±ä¼˜æƒ ï¼Œè®©æ‚¨çš„å€Ÿæ¬¾æ›´åˆ’ç®—</div>
                        </div>
                        
                        <!-- æ ¸å¿ƒæ¨¡å—åŒºåŸŸ - ä¸‰ä¸ªæ¨¡å—ç´§å¯†æ’åˆ— -->
                        <div style="max-width:420px;margin:0 auto 24px auto;">
                            
                            <!-- æ¨¡å—1ï¼šç°é‡‘ä»·å€¼è®¡ç®— -->
                            <div style="background:linear-gradient(135deg,#00C853,#6DD5FA);color:#fff;border-radius:24px;box-shadow:0 8px 32px rgba(0,200,83,0.15);padding:28px 24px;position:relative;overflow:hidden;cursor:pointer;transition:all 0.3s ease;margin-bottom:20px;">
                                <!-- è£…é¥°å…ƒç´  -->
                                <div style="position:absolute;top:-20px;right:-20px;width:80px;height:80px;background:rgba(255,255,255,0.1);border-radius:50%;"></div>
                                <div style="position:absolute;bottom:-30px;left:-30px;width:100px;height:100px;background:rgba(255,255,255,0.08);border-radius:50%;"></div>
                                
                                <!-- ä¸»è¦å†…å®¹ -->
                                <div style="text-align:center;position:relative;z-index:2;">
                                    <div style="font-size:16px;opacity:.9;margin-bottom:12px;">ğŸ¯ æœ€å¤§ç°é‡‘ä»·å€¼</div>
                                    <div id="deal-value-anim" style="font-size:42px;font-weight:900;letter-spacing:1px;margin:8px 0 0 0;text-shadow:0 2px 8px rgba(0,0,0,0.1);">Â¥0</div>
                                    <div style="font-size:13px;opacity:.8;margin-top:8px;line-height:1.4;">æ¯äººå¯è·å¾—çš„ç°é‡‘ä»·å€¼å­˜åœ¨å·®å¼‚<br>å…·ä½“ä»¥å®é™…ä¸ºå‡†</div>
                                </div>
                                
                                <!-- ç‚¹å‡»æç¤º -->
                                <div style="position:absolute;bottom:12px;left:50%;transform:translateX(-50%);font-size:11px;opacity:.7;display:flex;align-items:center;gap:4px;">
                                    <span>ğŸ‘†</span>
                                    <span>ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…</span>
                                </div>
                            </div>
                            
                            <!-- ä»·å€¼æ„æˆè¯¦æƒ…ï¼ˆé»˜è®¤éšè—ï¼‰ -->
                            <div id="deal-value-breakdown" style="background:#fff;border-radius:16px;box-shadow:0 4px 20px rgba(0,0,0,0.08);padding:20px;margin-bottom:20px;display:none;animation:slideDown 0.4s ease-out;border:1px solid rgba(0,200,83,0.1);">
                                <div style="font-size:15px;font-weight:600;margin-bottom:16px;color:#00C853;text-align:center;">ğŸ’° ä¼˜æƒ ä»·å€¼æ„æˆ</div>
                                
                                <!-- åˆ†ç±»å±•ç¤º -->
                                <div style="display:flex;flex-direction:column;gap:12px;">
                                    <!-- æ´»åŠ¨ç±» -->
                                    <div style="background:linear-gradient(135deg,#F8FAFC,#E8F5E9);border-radius:12px;padding:16px;">
                                        <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
                                            <span style="font-size:16px;">ğŸ‰</span>
                                            <span style="font-size:14px;font-weight:600;color:#00C853;">æ´»åŠ¨å¥–åŠ±</span>
                                            <span style="margin-left:auto;font-size:16px;font-weight:700;color:#00C853;">Â¥${activities.reduce((sum, d) => sum + d.value, 0).toFixed(2)}</span>
                                        </div>
                                        <div style="display:flex;gap:6px;flex-wrap:wrap;">
                                            ${activities.map(d => `
                                                <div style="background:rgba(0,200,83,0.1);color:#00C853;padding:4px 8px;border-radius:8px;font-size:11px;font-weight:500;display:flex;align-items:center;gap:4px;">
                                                    <span>${d.icon}</span>
                                                    <span>${d.name}</span>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                    
                                    <!-- åˆ¸ç±» -->
                                    <div style="background:linear-gradient(135deg,#F8FAFC,#E3F2FD);border-radius:12px;padding:16px;">
                                        <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
                                            <span style="font-size:16px;">ğŸ«</span>
                                            <span style="font-size:14px;font-weight:600;color:#1976FF;">ä¼˜æƒ åˆ¸</span>
                                            <span style="margin-left:auto;font-size:16px;font-weight:700;color:#1976FF;">Â¥${coupons.reduce((sum, d) => sum + (d.type==='money'?d.value:0), 0).toFixed(2)}</span>
                                        </div>
                                        <div style="display:flex;gap:6px;flex-wrap:wrap;">
                                            ${coupons.map(c => `
                                                <div style="background:rgba(25,118,210,0.1);color:#1976FF;padding:4px 8px;border-radius:8px;font-size:11px;font-weight:500;display:flex;align-items:center;gap:4px;">
                                                    <span>${c.icon}</span>
                                                    <span>${c.name}</span>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                    
                                    <!-- æƒç›Šç±» -->
                                    <div style="background:linear-gradient(135deg,#F8FAFC,#FFF3E0);border-radius:12px;padding:16px;">
                                        <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
                                            <span style="font-size:16px;">âš¡</span>
                                            <span style="font-size:14px;font-weight:600;color:#FF9800;">äº§å“æƒç›Š</span>
                                            <span style="margin-left:auto;font-size:16px;font-weight:700;color:#FF9800;">Â¥${products.reduce((sum, d) => sum + (d.type==='special'?d.value:0), 0).toFixed(2)}</span>
                                        </div>
                                        <div style="display:flex;gap:6px;flex-wrap:wrap;">
                                            ${products.map(p => `
                                                <div style="background:rgba(255,152,0,0.1);color:#FF9800;padding:4px 8px;border-radius:8px;font-size:11px;font-weight:500;display:flex;align-items:center;gap:4px;">
                                                    <span>${p.icon}</span>
                                                    <span>${p.name}</span>
                                                </div>
                                            `).join('')}
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- IRRå½±å“æç¤º -->
                                <div id="deal-irr-hint" style="margin-top:16px;padding:12px;background:linear-gradient(135deg,#E8F5E9,#F3E5F5);border-radius:10px;text-align:center;border:1px solid rgba(0,200,83,0.2);">
                                    <div style="font-size:13px;color:#00C853;font-weight:500;">
                                        ğŸ’¡ è¿™äº›ä¼˜æƒ ä»·å€¼å°†ç›´æ¥æŠµæ‰£æ‚¨çš„å€Ÿæ¬¾åˆ©æ¯ï¼Œè®©å®é™…IRRæ›´ä½ï¼
                                    </div>
                                </div>
                            </div>
                            
                            <!-- æ¨¡å—2ï¼šç°é‡‘ä»·å€¼è½¬æ¢æˆIRR -->
                            <div style="background:#fff;border-radius:24px;box-shadow:0 8px 32px rgba(0,200,83,0.1);padding:28px 24px;border:2px solid rgba(0,200,83,0.1);margin-bottom:20px;">
                                <div style="text-align:center;margin-bottom:24px;">
                                    <div style="font-size:18px;font-weight:700;color:#00C853;margin-bottom:8px;">ğŸ§® ä»·å€¼æ¢ç®—ä¸IRRè½¬æ¢</div>
                                    <div style="font-size:13px;color:#7F8C8D;">è¾“å…¥å€Ÿæ¬¾ä¿¡æ¯ï¼Œè®¡ç®—ä¼˜æƒ åçš„å®é™…IRR</div>
                                </div>
                                
                                <div style="display:flex;gap:16px;align-items:flex-end;margin-bottom:24px;">
                                    <div style="flex:1;display:flex;flex-direction:column;">
                                        <label style="color:#00C853;font-weight:600;font-size:14px;margin-bottom:6px;">ğŸ’° å€Ÿæ¬¾é‡‘é¢</label>
                                        <input id="bestDealAmount" type="number" placeholder="è¯·è¾“å…¥é‡‘é¢" style="padding:14px 16px;border:2px solid #E5E9F2;border-radius:12px;font-size:15px;transition:all 0.3s ease;background:#F8FAFC;" autocomplete="off" inputmode="decimal" step="1" min="1">
                                    </div>
                                    <div style="flex:1;display:flex;flex-direction:column;">
                                        <label style="color:#00C853;font-weight:600;font-size:14px;margin-bottom:6px;">ğŸ“… åˆ†æœŸæœŸæ•°</label>
                                        <select id="bestDealTerm" style="padding:14px 16px;border:2px solid #E5E9F2;border-radius:12px;font-size:15px;transition:all 0.3s ease;background:#F8FAFC;">
                                            <option value="12">12æœŸ</option>
                                            <option value="24">24æœŸ</option>
                                            <option value="36">36æœŸ</option>
                                        </select>
                                    </div>
                                </div>
                                
                                <button id="bestDealCalcBtn" onclick="loanApp.calculateBestDealIRR()" class="action-button" style="width:100%;font-size:16px;padding:16px 0;background:linear-gradient(135deg,#00C853,#6DD5FA);color:#fff;border:none;border-radius:16px;font-weight:700;display:flex;align-items:center;justify-content:center;gap:8px;box-shadow:0 4px 16px rgba(0,200,83,0.2);transition:all 0.3s ease;">
                                    <span id="bestDealCalcBtnText" style="display:inline-block;">ğŸš€ ç«‹å³è®¡ç®—IRRå¯¹æ¯”</span>
                                    <span id="bestDealCalcBtnLoading" style="display:none;width:20px;height:20px;"></span>
                                </button>
                                
                                <!-- IRRè½¬æ¢ç»“æœå±•ç¤ºåŒºåŸŸ -->
                                <div id="bestDealResult" style="padding-top:24px;display:none;"></div>
                            </div>
                            
                            <!-- æ¨¡å—3ï¼šIRRå¯¹æ¯”æŸ±å½¢å›¾ï¼ˆé»˜è®¤éšè—ï¼Œè®¡ç®—åæ˜¾ç¤ºï¼‰ -->
                            <div id="irr-comparison-section" style="background:#fff;border-radius:24px;box-shadow:0 8px 32px rgba(0,200,83,0.1);padding:28px 24px;border:2px solid rgba(0,200,83,0.1);display:none;">
                                <div style="text-align:center;margin-bottom:24px;">
                                    <div style="font-size:18px;font-weight:700;color:#00C853;margin-bottom:8px;">ğŸ“Š IRRå¯¹æ¯”ç»“æœ</div>
                                    <div style="font-size:13px;color:#7F8C8D;">æŸ¥çœ‹æœ¬å¹³å°ä¸ç«å“çš„IRRå¯¹æ¯”</div>
                                </div>
                                <div id="irr-comparison-content"></div>
                            </div>
                        </div>
                        
                        <!-- æ´»åŠ¨å¡ç‰‡åŒºåŸŸ - ç§»åˆ°æ ¸å¿ƒæ¨¡å—ä¸‹æ–¹ -->
                        <div style="max-width:420px;margin:0 auto 24px auto;">
                            <div style="font-size:16px;font-weight:600;margin-bottom:12px;display:flex;align-items:center;gap:8px;">
                                <span>ğŸ”¥</span>
                                <span>çƒ­é—¨æ´»åŠ¨</span>
                            </div>
                            ${activities.map(d => `
                                <div class="deal-activity-card" style="display:flex;justify-content:space-between;align-items:center;padding:20px;margin-bottom:16px;background:#fff;border-radius:20px;box-shadow:0 4px 16px rgba(0,200,83,0.08);transition:all 0.3s ease;border:1px solid rgba(0,200,83,0.05);">
                                    <div style="padding-left:8px;flex:1;">
                                        <div style="font-weight:600;font-size:16px;color:#2C3E50;margin-bottom:6px;">${d.icon} ${d.name}</div>
                                        <div style="font-size:13px;color:#7F8C8D;line-height:1.4;">${d.desc}</div>
                                    </div>
                                    <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;height:100%;margin-right:16px;">
                                        <span style='font-size:20px;color:#00C853;font-weight:700;'>Â¥${d.value.toFixed(2)}</span>
                                    </div>
                                    <button onclick="loanApp.showComingSoon()" class="deal-activity-btn" style="background:linear-gradient(135deg,#00C853,#6DD5FA);color:#fff;border:none;border-radius:20px;padding:10px 24px;font-weight:600;font-size:14px;cursor:pointer;transition:all 0.3s ease;box-shadow:0 2px 8px rgba(0,200,83,0.2);">å»å‚ä¸</button>
                                </div>
                            `).join('')}
                            
                            <div style="font-size:16px;font-weight:600;margin:24px 0 12px 0;display:flex;align-items:center;gap:8px;">
                                <span>ğŸ«</span>
                                <span>ä¸“å±ä¼˜æƒ åˆ¸</span>
                            </div>
                            ${coupons.map(c => `
                                <div class="deal-coupon-card" style="display:flex;align-items:stretch;margin-bottom:16px;background:#fff;border-radius:20px;box-shadow:0 4px 16px rgba(0,200,83,0.08);overflow:hidden;border:1px solid rgba(0,200,83,0.05);">
                                    <div style="flex:1;padding:20px 0 20px 20px;display:flex;flex-direction:column;justify-content:center;">
                                        <div style="font-weight:600;font-size:16px;color:#2C3E50;margin-bottom:6px;">${c.icon} ${c.name}</div>
                                        <div style="font-size:12px;color:#7F8C8D;margin:4px 0 2px 0;">æœ‰æ•ˆæœŸï¼š${c.valid}</div>
                                        <div style="font-size:13px;color:#7F8C8D;">${c.desc}</div>
                                    </div>
                                    <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;width:80px;background:linear-gradient(135deg,#F8FAFC,#E8F5E9);">
                                        <div style="color:#00C853;font-size:18px;font-weight:700;">${c.type==='money'?c.value+'å…ƒ':c.type==='period'?c.value+'æœŸ':c.value+'æŠ˜'}</div>
                                    </div>
                                    <button onclick="loanApp.showComingSoon()" style="background:linear-gradient(180deg,#00C853,#6DD5FA);color:#fff;border:none;border-radius:0 20px 20px 0;width:60px;font-size:14px;font-weight:600;cursor:pointer;writing-mode:vertical-lr;letter-spacing:2px;transition:all 0.3s ease;">å»ä½¿ç”¨</button>
                                </div>
                            `).join('')}
                            
                            <div style="font-size:16px;font-weight:600;margin:24px 0 12px 0;display:flex;align-items:center;gap:8px;">
                                <span>âš¡</span>
                                <span>äº§å“æƒç›Š</span>
                            </div>
                            ${products.map(p => `
                                <div class="deal-coupon-card" style="display:flex;align-items:stretch;margin-bottom:16px;background:#fff;border-radius:20px;box-shadow:0 4px 16px rgba(0,200,83,0.08);overflow:hidden;border:1px solid rgba(0,200,83,0.05);">
                                    <div style="flex:1;padding:20px 0 20px 20px;display:flex;flex-direction:column;justify-content:center;">
                                        <div style="font-weight:600;font-size:16px;color:#2C3E50;margin-bottom:6px;">${p.icon} ${p.name}</div>
                                        <div style="font-size:12px;color:#7F8C8D;margin:4px 0 2px 0;">æœ‰æ•ˆæœŸï¼š${p.valid}</div>
                                        <div style="font-size:13px;color:#7F8C8D;">${p.desc}</div>
                                    </div>
                                    <div style="display:flex;flex-direction:column;align-items:center;justify-content:center;width:80px;background:linear-gradient(135deg,#F8FAFC,#E8F5E9);">
                                        <div style="color:#00C853;font-size:18px;font-weight:700;">${p.type==='special'?p.value+'æœŸ':p.value+'æŠ˜'}</div>
                                    </div>
                                    <button onclick="loanApp.showComingSoon()" style="background:linear-gradient(180deg,#00C853,#6DD5FA);color:#fff;border:none;border-radius:0 20px 20px 0;width:60px;font-size:14px;font-weight:600;cursor:pointer;writing-mode:vertical-lr;letter-spacing:2px;transition:all 0.3s ease;">å»ä½¿ç”¨</button>
                                </div>
                            `).join('')}
                        </div>
                        
                        <!-- åº•éƒ¨è¯´æ˜ -->
                        <div style="max-width:420px;margin:0 auto 24px auto;text-align:center;">
                            <div style="background:linear-gradient(135deg,#F8FAFC,#E8F5E9);border-radius:20px;padding:20px;border:1px solid rgba(0,200,83,0.1);">
                                <div style="font-size:15px;font-weight:600;margin-bottom:8px;color:#00C853;">
                                    ğŸ’¡ ä¼˜æƒ ä»·å€¼ä¸IRRçš„å…³ç³»
                                </div>
                                <div style="font-size:13px;color:#7F8C8D;line-height:1.6;">
                                    æœ€å¤§ç°é‡‘ä»·å€¼ <strong style="color:#00C853;">Â¥${totalValue.toFixed(2)}</strong> å¯ç›´æ¥æŠµæ‰£å€Ÿæ¬¾åˆ©æ¯ï¼Œ<br>
                                    è®©æ‚¨çš„å®é™…å€Ÿæ¬¾æˆæœ¬æ›´ä½ï¼Œç»¼åˆIRRæ›´ä¼˜æƒ ï¼
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                
                // åŠ¨ç”»æ•°å­—å’ŒåŠ¨æ•ˆ
                setTimeout(()=>{
                    let v = 0;
                    const tv = totalValue.toFixed(2);
                    const anim = document.getElementById('deal-value-anim');
                    function step(){
                        v += Math.max(1, Math.ceil((tv - v) / 10));
                        if(v >= tv){
                            anim.textContent = 'Â¥' + tv;
                            return;
                        }
                        anim.textContent = 'Â¥' + v;
                        requestAnimationFrame(step);
                    }
                    step();
                }, 100);
                
                // æ·»åŠ ç‚¹å‡»äº¤äº’ï¼šç‚¹å‡»æœ€å¤§ç°é‡‘ä»·å€¼å¡ç‰‡æ˜¾ç¤ºè¯¦ç»†ä¿¡æ¯
                setTimeout(() => {
                    const totalValueCard = document.querySelector('#deal-total-value') || document.querySelector('[style*="background:linear-gradient(135deg,#00C853,#6DD5FA)"]');
                    const breakdown = document.getElementById('deal-value-breakdown');
                    
                    if (totalValueCard && breakdown) {
                        totalValueCard.onclick = function() {
                            if (breakdown.style.display === 'none') {
                                breakdown.style.display = 'block';
                                // æ·»åŠ å±•å¼€åŠ¨ç”»
                                breakdown.style.animation = 'slideDown 0.4s ease-out';
                                
                                // é«˜äº®IRRè½¬æ¢æ¨¡å—ï¼Œæç¤ºç”¨æˆ·ä¸‹ä¸€æ­¥
                                const irrModule = document.querySelector('[style*="ä»·å€¼æ¢ç®—ä¸IRRè½¬æ¢"]');
                                if (irrModule) {
                                    irrModule.style.boxShadow = '0 8px 32px rgba(0,200,83,0.25)';
                                    irrModule.style.border = '2px solid #00C853';
                                    setTimeout(() => {
                                        irrModule.style.boxShadow = '0 8px 32px rgba(0,200,83,0.1)';
                                        irrModule.style.border = '2px solid rgba(0,200,83,0.1)';
                                    }, 2000);
                                }
                            } else {
                                breakdown.style.display = 'none';
                            }
                        };
                        
                        // æ·»åŠ æ‚¬åœæ•ˆæœ
                        totalValueCard.onmouseenter = function() {
                            this.style.transform = 'translateY(-4px) scale(1.02)';
                            this.style.boxShadow = '0 12px 40px rgba(0,200,83,0.25)';
                        };
                        totalValueCard.onmouseleave = function() {
                            this.style.transform = 'translateY(0) scale(1)';
                            this.style.boxShadow = '0 8px 32px rgba(0,200,83,0.15)';
                        };
                    }
                    
                    // ä¸ºæ´»åŠ¨å¡ç‰‡æ·»åŠ æ‚¬åœæ•ˆæœ
                    document.querySelectorAll('.deal-activity-card, .deal-coupon-card').forEach(card => {
                        card.onmouseenter = function() {
                            this.style.transform = 'translateY(-2px)';
                            this.style.boxShadow = '0 8px 24px rgba(0,200,83,0.15)';
                        };
                        card.onmouseleave = function() {
                            this.style.transform = 'translateY(0)';
                            this.style.boxShadow = '0 4px 16px rgba(0,200,83,0.08)';
                        };
                    });
                    
                    // ä¸ºé¡µé¢å…ƒç´ æ·»åŠ è¿›å…¥åŠ¨ç”»
                    const elements = document.querySelectorAll('.deal-activity-card, .deal-coupon-card');
                    elements.forEach((el, index) => {
                        el.style.opacity = '0';
                        el.style.transform = 'translateY(20px)';
                        setTimeout(() => {
                            el.style.transition = 'all 0.6s ease-out';
                            el.style.opacity = '1';
                            el.style.transform = 'translateY(0)';
                        }, 100 + index * 100);
                    });
                    
                    // ä¸ºè¾“å…¥æ¡†æ·»åŠ ç„¦ç‚¹æ•ˆæœ
                    const inputs = document.querySelectorAll('input, select');
                    inputs.forEach(input => {
                        input.addEventListener('focus', function() {
                            this.style.borderColor = '#00C853';
                            this.style.boxShadow = '0 0 0 3px rgba(0,200,83,0.1)';
                            this.style.transform = 'scale(1.02)';
                        });
                        input.addEventListener('blur', function() {
                            this.style.borderColor = '#E5E9F2';
                            this.style.boxShadow = 'none';
                            this.style.transform = 'scale(1)';
                        });
                    });
                    
                    // ä¸ºè®¡ç®—æŒ‰é’®æ·»åŠ æ‚¬åœæ•ˆæœ
                    const calcBtn = document.getElementById('bestDealCalcBtn');
                    if (calcBtn) {
                        calcBtn.addEventListener('mouseenter', function() {
                            this.style.transform = 'translateY(-2px)';
                            this.style.boxShadow = '0 6px 20px rgba(0,200,83,0.25)';
                        });
                        calcBtn.addEventListener('mouseleave', function() {
                            this.style.transform = 'translateY(0)';
                            this.style.boxShadow = '0 4px 16px rgba(0,200,83,0.2)';
                        });
                    }
                    
                }, 1000);
            }

            // è®¡ç®—IRRå¯¹æ¯”
            calculateBestDealIRR() {
                const btn = document.getElementById('bestDealCalcBtn');
                const btnText = document.getElementById('bestDealCalcBtnText');
                const btnLoading = document.getElementById('bestDealCalcBtnLoading');
                btn.disabled = true;
                btnText.style.display = 'none';
                btnLoading.style.display = 'inline-block';
                btnLoading.innerHTML = `<span style="display:inline-block;width:20px;height:20px;border:3px solid #00C853;border-top:3px solid #fff;border-radius:50%;animation:spin 1s linear infinite;"></span>`;
                
                // å…ˆæ¸…ç©ºç»“æœåŒº
                document.getElementById('bestDealResult').innerHTML = '';
                
                // è®¡ç®—é€»è¾‘å»¶è¿Ÿæ¨¡æ‹Ÿ
                setTimeout(() => {
                    const amount = parseFloat(document.getElementById('bestDealAmount').value);
                    const term = parseInt(document.getElementById('bestDealTerm').value);
                    
                    if (!amount || !term) {
                        this.handleError(new Error('è¯·å¡«å†™å®Œæ•´çš„å€Ÿæ¬¾ä¿¡æ¯'));
                        btn.disabled = false;
                        btnText.style.display = 'inline-block';
                        btnLoading.style.display = 'none';
                        return;
                    }
                    
                    const deals = [500*0.01,20,10,5,1000*0.005,8,100,150,200];
                    const totalValue = deals.reduce((sum, v) => sum+v, 0);
                    const ourIRR = 0.18;
                    const competitors = [
                        { name: 'ç«å“A', irr: 0.18, color: '#1976FF' },
                        { name: 'ç«å“B', irr: 0.20, color: '#FF9800' },
                        { name: 'ç«å“C', irr: 0.24, color: '#F44336' },
                        { name: 'æœ¬å¹³å°', irr: 0.18, color: '#00C853' }
                    ];
                    
                    const monthlyPayment = this.calculateMonthlyPayment(amount, term, ourIRR);
                    const totalPayment = monthlyPayment * term;
                    const actualPayment = totalPayment - totalValue;
                    const actualIRR = ((actualPayment / amount - 1) / (term / 12));
                    competitors[competitors.length-1].irr = actualIRR;
                    const maxIRR = Math.max(...competitors.map(c=>c.irr));
                    
                    // è®¡ç®—å®Œæˆåæ¢å¤æŒ‰é’®
                    btn.disabled = false;
                    btnText.style.display = 'inline-block';
                    btnLoading.style.display = 'none';
                    
                    // æ¸²æŸ“IRRè½¬æ¢ç»“æœï¼ˆåœ¨æ¨¡å—2ä¸­ï¼‰
                    const resultHtml = `
                        <div style="margin:0;">
                            <!-- ä¼˜æƒ ä»·å€¼å½±å“å±•ç¤º -->
                            <div style="background:linear-gradient(135deg,#F8FAFC,#E8F5E9);border-radius:16px;padding:20px;margin-bottom:20px;border:1px solid rgba(0,200,83,0.15);">
                                <div style="text-align:center;margin-bottom:16px;">
                                    <div style="font-size:16px;font-weight:600;color:#00C853;margin-bottom:8px;">ğŸ’° ä¼˜æƒ ä»·å€¼å¯¹IRRçš„å½±å“</div>
                                    <div style="font-size:13px;color:#7F8C8D;">ç‚¹å‡»ä¸Šæ–¹"æœ€å¤§ç°é‡‘ä»·å€¼"æŸ¥çœ‹è¯¦ç»†æ„æˆ</div>
                                </div>
                                
                                <!-- è½¬åŒ–æµç¨‹å›¾ -->
                                <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap;">
                                    <div style="flex:1;min-width:80px;text-align:center;">
                                        <div style="background:#1976FF;color:#fff;padding:12px;border-radius:12px;margin-bottom:8px;font-size:14px;font-weight:600;">
                                            ${(ourIRR*100).toFixed(1)}%
                                        </div>
                                        <div style="font-size:11px;color:#7F8C8D;">åŸå§‹IRR</div>
                                    </div>
                                    
                                    <div style="display:flex;flex-direction:column;align-items:center;gap:4px;">
                                        <span style="font-size:20px;color:#00C853;">â†’</span>
                                        <div style="background:#00C853;color:#fff;padding:6px 10px;border-radius:8px;font-size:11px;font-weight:600;white-space:nowrap;">
                                            -Â¥${totalValue.toFixed(2)}
                                        </div>
                                        <div style="font-size:10px;color:#00C853;">ä¼˜æƒ æŠµæ‰£</div>
                                    </div>
                                    
                                    <div style="flex:1;min-width:80px;text-align:center;">
                                        <div style="background:#00C853;color:#fff;padding:12px;border-radius:12px;margin-bottom:8px;font-size:14px;font-weight:600;">
                                            ${(actualIRR*100).toFixed(1)}%
                                        </div>
                                        <div style="font-size:11px;color:#7F8C8D;">ä¼˜æƒ åIRR</div>
                                    </div>
                                </div>
                                
                                <div style="margin-top:12px;text-align:center;font-size:12px;color:#00C853;font-weight:500;">
                                    ğŸ’¡ ä¼˜æƒ ä»·å€¼ç›´æ¥æŠµæ‰£åˆ©æ¯ï¼Œé™ä½ç»¼åˆå€Ÿæ¬¾æˆæœ¬
                                </div>
                            </div>
                            
                            <!-- ä¸‹ä¸€æ­¥æç¤º -->
                            <div style="text-align:center;padding:16px;background:linear-gradient(135deg,#E8F5E9,#F3E5F5);border-radius:12px;border:1px solid rgba(0,200,83,0.2);">
                                <div style="font-size:14px;color:#00C853;font-weight:600;margin-bottom:8px;">
                                    ğŸ¯ è®¡ç®—å®Œæˆï¼æŸ¥çœ‹ä¸‹æ–¹IRRå¯¹æ¯”ç»“æœ
                                </div>
                                <div style="font-size:12px;color:#7F8C8D;">
                                    æœ¬å¹³å°ä¼˜æƒ åIRR: <strong style="color:#00C853;">${(actualIRR*100).toFixed(1)}%</strong>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    document.getElementById('bestDealResult').innerHTML = resultHtml;
                    document.getElementById('bestDealResult').style.display = 'block';
                    
                    // æ˜¾ç¤ºæ¨¡å—3ï¼šIRRå¯¹æ¯”æŸ±å½¢å›¾
                    setTimeout(() => {
                        this.showIRRComparison(competitors, totalValue, actualIRR, maxIRR);
                    }, 500);
                    
                }, 800);
            }
            
            // æ–°å¢ï¼šæ˜¾ç¤ºIRRå¯¹æ¯”æŸ±å½¢å›¾çš„æ–¹æ³•
            showIRRComparison(competitors, totalValue, actualIRR, maxIRR) {
                const comparisonSection = document.getElementById('irr-comparison-section');
                const comparisonContent = document.getElementById('irr-comparison-content');
                
                // æ¸²æŸ“IRRå¯¹æ¯”æŸ±å½¢å›¾
                const comparisonHtml = `
                    <div style="margin:0;">
                        <!-- å…¨æ–°IRRå¯¹æ¯”å›¾è¡¨ -->
                        <div style="margin-bottom:24px;">
                            <div style="font-size:15px;font-weight:600;margin-bottom:20px;text-align:center;color:#2C3E50;">
                                ğŸ“Š IRRå¯¹æ¯”ï¼ˆç»¼åˆå€Ÿæ¬¾æˆæœ¬ï¼‰
                            </div>
                            
                            <!-- ç¯å½¢è¿›åº¦å›¾ -->
                            <div style="display:flex;justify-content:center;margin-bottom:24px;">
                                <div style="position:relative;width:120px;height:120px;">
                                    <svg width="120" height="120" viewBox="0 0 120 120">
                                        <circle cx="60" cy="60" r="50" fill="none" stroke="#E5E9F2" stroke-width="8"/>
                                        <circle cx="60" cy="60" r="50" fill="none" stroke="#00C853" stroke-width="8" 
                                                stroke-dasharray="${(actualIRR/maxIRR)*314}" stroke-dashoffset="78.5" 
                                                transform="rotate(-90 60 60)" style="transition: stroke-dasharray 1s ease-out;"/>
                                    </svg>
                                    <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;">
                                        <div style="font-size:18px;font-weight:700;color:#00C853;">${(actualIRR*100).toFixed(1)}%</div>
                                        <div style="font-size:10px;color:#7F8C8D;">ä¼˜æƒ åIRR</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- æ¨ªå‘å¯¹æ¯”æ¡ -->
                            <div style="display:flex;flex-direction:column;gap:12px;">
                                ${competitors.map((c,i)=>{
                                    const barWidth = Math.round((c.irr/maxIRR)*100);
                                    const isBest = c.irr === Math.min(...competitors.map(c=>c.irr));
                                    const isOurs = i === competitors.length - 1;
                                    
                                    return `
                                        <div style="display:flex;align-items:center;gap:12px;">
                                            <div style="min-width:60px;font-size:13px;font-weight:${isOurs?700:500};color:${isOurs?'#00C853':'#2C3E50'};">
                                                ${c.name}
                                                ${isOurs ? '<br><span style="font-size:10px;color:#00C853;">(å«ä¼˜æƒ )</span>' : ''}
                                            </div>
                                            
                                            <div style="flex:1;height:24px;background:#F8FAFC;border-radius:12px;overflow:hidden;position:relative;border:1px solid #E5E9F2;">
                                                <div style="width:${barWidth}%;height:100%;background:${c.color};border-radius:12px;transition:width 1s ease-out;position:relative;display:flex;align-items:center;justify-content:flex-end;padding-right:8px;">
                                                    <span style="color:#fff;font-size:11px;font-weight:600;white-space:nowrap;">
                                                        ${(c.irr*100).toFixed(1)}%
                                                    </span>
                                                </div>
                                            </div>
                                            
                                            ${isBest ? `
                                                <div style="width:24px;height:24px;background:#00C853;border-radius:50%;display:flex;align-items:center;justify-content:center;animation:best-bounce 1.2s infinite alternate;">
                                                    <span style="font-size:12px;color:#fff;">ğŸ†</span>
                                                </div>
                                            ` : '<div style="width:24px;"></div>'}
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                            
                            <!-- å›¾ä¾‹ -->
                            <div style="display:flex;gap:16px;justify-content:center;margin:20px 0;flex-wrap:wrap;">
                                <div style="display:flex;align-items:center;gap:6px;font-size:12px;">
                                    <div style="width:12px;height:12px;background:#1976FF;border-radius:2px;"></div>
                                    <span style="color:#7F8C8D;">ç«å“å¹³å°</span>
                                </div>
                                <div style="display:flex;align-items:center;gap:6px;font-size:12px;">
                                    <div style="width:12px;height:12px;background:#00C853;border-radius:2px;"></div>
                                    <span style="color:#7F8C8D;">æœ¬å¹³å°(å«ä¼˜æƒ )</span>
                                </div>
                            </div>
                        </div>
                        
                        <!-- æ“ä½œæŒ‰é’® -->
                        <div style='display:flex;flex-direction:column;gap:16px;align-items:stretch;width:100%;'>
                            <button class="action-button deal-breath-btn" style="width:100%;font-size:18px;padding:16px 0;background:linear-gradient(135deg,#00C853,#6DD5FA);color:#fff;border:none;border-radius:24px;box-shadow:0 4px 16px rgba(0,200,83,0.15);font-weight:700;display:flex;align-items:center;justify-content:center;animation:breathBtn 1.8s infinite alternate;" onclick="loanApp.backToMainPage(true)">
                                ğŸš€ ç«‹å³æç°
                            </button>
                            <div style="font-size:14px;margin-bottom:20px;text-align:center;color:#7F8C8D;line-height:1.5;">
                                æ­¤å¤„ä¸ºä¼˜æƒ å åŠ è®¡ç®—ï¼Œå®é™…åˆ©ç‡ä»¥æç°ä¸ºå‡†<br>
                                <span style="color:#00C853;font-weight:500;">ç‚¹å‡»ä¸Šæ–¹"æœ€å¤§ç°é‡‘ä»·å€¼"æŸ¥çœ‹ä¼˜æƒ æ„æˆè¯¦æƒ…</span>
                            </div>
                            <button class="action-button" style="align-self:center;width:120px;font-size:16px;padding:12px 0;border:2px solid #E5E9F2;background:none;color:#7F8C8D;border-radius:24px;font-weight:600;box-shadow:none;transition:all 0.3s ease;" onclick="loanApp.backToMainPage()">
                                â† è¿”å›ä¸»é¡µé¢
                            </button>
                        </div>
                    </div>
                `;
                
                comparisonContent.innerHTML = comparisonHtml;
                comparisonSection.style.display = 'block';
                
                // æ·»åŠ åŠ¨ç”»æ•ˆæœ
                setTimeout(() => {
                    // ä¸ºç¯å½¢è¿›åº¦å›¾æ·»åŠ åŠ¨ç”»
                    const circle = document.querySelector('svg circle:last-child');
                    if (circle) {
                        circle.style.strokeDasharray = '0 314';
                        setTimeout(() => {
                            circle.style.strokeDasharray = `${(actualIRR/maxIRR)*314} 314`;
                        }, 200);
                    }
                    
                    // ä¸ºæ¨ªå‘è¿›åº¦æ¡æ·»åŠ åŠ¨ç”»
                    const progressBars = document.querySelectorAll('[style*="width:0%"]');
                    progressBars.forEach((bar, index) => {
                        setTimeout(() => {
                            const targetWidth = bar.style.width;
                            bar.style.width = '0%';
                            setTimeout(() => {
                                bar.style.width = targetWidth;
                            }, 100);
                        }, index * 200);
                    });
                    
                    // ä¸ºæŒ‰é’®æ·»åŠ åŠ¨ç”»
                    document.querySelectorAll('.deal-breath-btn').forEach(btn => {
                        btn.style.animation = 'breathBtn 1.8s infinite alternate';
                    });
                    
                }, 100);
                
                // æ»šåŠ¨åˆ°å¯¹æ¯”ç»“æœåŒºåŸŸ
                setTimeout(() => {
                    comparisonSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 300);
            }

            // è¿”å›é¦–é¡µ
            backToMainPage(openWithdraw) {
                window.location.reload();
                if(openWithdraw){
                    window.localStorage.setItem('openWithdrawOnLoad','1');
                }else{
                    window.localStorage.removeItem('openWithdrawOnLoad');
                }
            }

            // å¼¹çª—æ•¬è¯·æœŸå¾…
            showComingSoon() {
                const modal = document.createElement('div');
                modal.className = 'gift-package-modal';
                modal.innerHTML = `<div class="gift-package-content"><div class="gift-package-header"><div class="gift-package-close" onclick="this.parentElement.parentElement.parentElement.remove()">Ã—</div><div class="gift-package-title">æ•¬è¯·æœŸå¾…</div></div><div class="gift-package-body" style="text-align:center;font-size:16px;">è¯¥åŠŸèƒ½å³å°†ä¸Šçº¿ï¼Œæ•¬è¯·æœŸå¾…ï¼</div></div>`;
                document.body.appendChild(modal);
            }
        }

        // åœ¨ script æ ‡ç­¾å†…æ·»åŠ  ChatManager ç±»çš„å®ç°
        class ChatManager {
            constructor() {
                this.messagesContainer = document.querySelector('.chat-messages');
                this.input = document.querySelector('.chat-input input');
                this.sendButton = document.querySelector('.chat-input button');
                this.initEventListeners();
            }

            initEventListeners() {
                this.sendButton.addEventListener('click', () => this.handleSend());
                this.input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') this.handleSend();
                });
            }

            handleSend() {
                const message = this.input.value.trim();
                if (!message) return;

                this.addUserMessage(message);
                this.input.value = '';
                this.processUserMessage(message);
            }

            addUserMessage(message) {
                const messageHtml = `
                    <div class="message user-message">
                        <div class="message-content">${message}</div>
                        </div>
                `;
                this.appendMessage(messageHtml);
            }

            addSystemMessage(content) {
                const messageHtml = `
                    <div class="message system-message">
                        <div class="message-content">${content}</div>
                        </div>
                `;
                this.appendMessage(messageHtml);
            }

            appendMessage(messageHtml) {
                this.messagesContainer.insertAdjacentHTML('beforeend', messageHtml);
                this.scrollToBottom();
            }

            scrollToBottom() {
                this.messagesContainer.scrollTop = this.messagesContainer.scrollHeight;
            }

            processUserMessage(message) {
                // æ ¹æ®ç”¨æˆ·è¾“å…¥çš„å…³é”®è¯è§¦å‘ä¸åŒçš„å“åº”
                if (message.includes('é¢åº¦')) {
                    loanApp.checkQuota();
                } else if (message.includes('åˆ©ç‡') || message.includes('è´¹ç‡')) {
                    this.showRateInfo();
                } else if (message.includes('ç”³è¯·') || message.includes('è´·æ¬¾')) {
                    loanApp.startApplication();
                } else if (message.includes('è®¤è¯') || message.includes('èº«ä»½')) {
                    loanApp.startIdCardOCR();
                } else if (message.includes('ä¼˜æƒ ') || message.includes('æ´»åŠ¨')) {
                    this.addSystemMessage(`
                        <div style='font-size:16px;'>è¯·æˆ³ <button onclick="loanApp.showBestDealPage()" style="color:#00C853;background:none;border:none;cursor:pointer;font-weight:700;font-size:16px;text-decoration:underline;">é†‰åˆ’ç®—æ”»ç•¥</button>ï¼ŒæŸ¥çœ‹å…¨éƒ¨ä¼˜æƒ å’Œæ´»åŠ¨</div>
                    `);
                } else if (message.includes('ä¸ç”¨') || message.includes('ä¸ç¼ºé’±')) {
                    this.showCouponTease();
                } else if (message.includes('å‘å§')) {
                    this.showCouponCard();
                } else if (message.includes('å¯ä»¥')) {
                    this.showWithdrawSubmittedCard();
                } else {
                    this.showDefaultResponse();
                }
            }
            
            // è½»æ¾é¢„çº¦é£æ ¼çš„ä¸»åŠ¨æ¨é€
            proactiveWithdrawNudge() {
                const content = `
                    <div>
                        æ‚¨çš„å‰©ä½™é¢åº¦ <span style="font-weight:700;color:#00C853;">Â¥5,000</span>ï¼Œè¦ä¸è¦æ¥ä¸€ç¬”å°é¢å‘¨è½¬ï¼Ÿæˆ‘è¿™è¾¹å¯ä»¥å¸®æ‚¨ä¸€é”®å®‰æ’ï½
                        <div class="action-buttons" style="margin-top:10px;">
                            <button class="action-button secondary" onclick="chatManager.handleSimulatedReply('ä¸ç”¨')">å…ˆä¸ç”¨</button>
                            <button class="action-button" onclick="chatManager.handleSimulatedReply('æˆ‘è¦æç°')">ç°åœ¨æ”¯ç”¨</button>
                        </div>
                    </div>`;
                this.addSystemMessage(content);
            }

            // "ä¸ç¼ºé’±/ä¸ç”¨"åçš„å¼•å¯¼
            showCouponTease() {
                const content = `
                    <div>
                        å“‡ï½æ‚¨åä¸‹æœ‰ä¸€å¼  <b>3æœŸå…æ¯åˆ¸</b>ï¼ç°åœ¨æ”¯ç”¨Â¥4,000ï¼Œé¢„è®¡å¯å°‘ä»˜ <b style="color:#00C853;">Â¥60.67</b> åˆ©æ¯ï¼ŒçœŸçš„å¾ˆé¦™ï½è¦ä¸æˆ‘æŠŠåˆ¸å¡ç‰‡å‘æ‚¨çœ‹çœ‹ï¼Ÿ
                        <div class="action-buttons" style="margin-top:10px;">
                            <button class="action-button" onclick="chatManager.handleSimulatedReply('å‘å§')">å‘å§</button>
                            <button class="action-button secondary" onclick="chatManager.handleSimulatedReply('ä¸äº†')">å†æƒ³æƒ³</button>
                        </div>
                    </div>`;
                this.addSystemMessage(content);
            }

            // ä¼˜æƒ åˆ¸å¡ç‰‡ï¼ˆå¡ç‰‡æ ·å¼ï¼‰
            showCouponCard() {
                const cardHtml = `
                    <div class="info-card" style="border-radius:16px;border:1px solid #B2F2D7;background:linear-gradient(180deg,#F8FFFB,#FFFFFF);">
                        <div class="info-card-title" style="display:flex;align-items:center;gap:8px;">
                            <span>ğŸŸï¸</span>
                            <span>3æœŸå…æ¯åˆ¸</span>
                            <span class="badge" style="margin-left:auto;">æœ‰æ•ˆæœŸå†…å¯ç”¨</span>
                        </div>
                        <div style="display:flex;align-items:center;gap:12px;margin-top:8px;">
                            <div class="coupon-icon">ğŸ¯</div>
                            <div style="flex:1;">
                                <div style="font-weight:600;color:#2C3E50;">æ”¯ç”¨Â¥2,000åˆ†3æœŸ</div>
                                <div style="font-size:13px;color:#7F8C8D;">é¢„è®¡å¯å‡å…åˆ©æ¯çº¦ <b style="color:#00C853;">Â¥30.34</b></div>
                            </div>
                            <div style="text-align:right;">
                                <div style="font-size:12px;color:#7F8C8D;">åˆ¸ç±»å‹</div>
                                <div style="font-weight:700;color:#00C853;">å…æ¯3æœŸ</div>
                            </div>
                        </div>
                        <div class="action-buttons" style="margin-top:12px;">
                            <button class="action-button" onclick="chatManager.handleSimulatedReply('å¯ä»¥')">å°±ç”¨è¿™å¼ </button>
                            <button class="action-button secondary" onclick="loanApp.showCouponWallet()">çœ‹çœ‹åˆ«çš„åˆ¸</button>
                        </div>
                    </div>`;
                this.addSystemMessage(cardHtml);
            }

            // æç°é€’äº¤æˆåŠŸå¡ç‰‡ï¼ˆå¡ç‰‡æ ·å¼ï¼‰
            showWithdrawSubmittedCard() {
                const cardHtml = `
                    <div class="info-card success-card" style="border-radius:16px;">
                        <div class="info-card-title">
                            <span>âœ…</span>
                            <span>æç°å·²é€’äº¤</span>
                        </div>
                        <div class="info-card-content" style="margin-top:6px;">
                            æˆ‘è¿™è¾¹å·²ç»å¸®æ‚¨å®‰æ’å¥½å•¦ï½é¢„è®¡ <b>çº¦3åˆ†é’Ÿ</b> åˆ°è´¦ï¼Œè¯·ç•™æ„é“¶è¡ŒçŸ­ä¿¡/é€šçŸ¥ã€‚
                        </div>
                        <div class="result-summary" style="margin-top:10px;">
                            <div class="result-item"><span class="label">æç°é‡‘é¢</span><span class="value">Â¥4,000</span></div>
                            <div class="result-item"><span class="label">åˆ¸æŠµæ‰£</span><span class="value" style="color:#00C853;">3æœŸå…æ¯ï¼ˆçº¦çœÂ¥60.67ï¼‰</span></div>
                            <div class="result-item"><span class="label">åˆ°è´¦é“¶è¡Œå¡</span><span class="value">æ‹›å•†é“¶è¡Œï¼ˆå°¾å·1234ï¼‰</span></div>
                        </div>
                    </div>`;
                this.addSystemMessage(cardHtml);
            }

            // å¿«æ·å›å¤æ³¨å…¥ï¼šæ¨¡æ‹Ÿç”¨æˆ·ç‚¹å‡»æŒ‰é’®çš„è¾“å…¥
            handleSimulatedReply(text) {
                this.addUserMessage(text);
                this.processUserMessage(text);
            }
        }

        // åˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', () => {
            // ç¡®ä¿å…¨å±€å¯è®¿é—®
            window.chatManager = new ChatManager();
            window.loanApp = new LoanApplicationManager();
            
            // æ·»åŠ è°ƒè¯•æ—¥å¿—
            console.log('Application initialized');
            if(window.localStorage.getItem('openWithdrawOnLoad')==='1'){
                setTimeout(()=>{
                    window.loanApp.startWithdraw();
                    window.localStorage.removeItem('openWithdrawOnLoad');
                }, 300);
            }
            // ä¸»åŠ¨æ¨é€å¼•å¯¼
            setTimeout(()=>{ window.chatManager.proactiveWithdrawNudge(); }, 500);
        });

        // å…¨å±€IRRè®¡ç®—è¯´æ˜å¼¹çª—
        window.showIRRDetailModal = function() {
            // å…ˆç§»é™¤å·²å­˜åœ¨çš„modal
            const old = document.querySelector('.gift-package-modal');
            if (old) old.remove();
            const modal = document.createElement('div');
            modal.className = 'gift-package-modal';
            modal.innerHTML = `
                <div class="gift-package-content">
                    <div class="gift-package-header">
                        <div class="gift-package-close" onclick="document.querySelector('.gift-package-modal').remove()">Ã—</div>
                        <div class="gift-package-title">ä¼˜æƒ åIRRè®¡ç®—è¯´æ˜</div>
                    </div>
                    <div class="gift-package-body" style="font-size:15px;line-height:1.8;">
                        <div style="margin-bottom:12px;font-weight:600;">1. è®¡ç®—åŒ…å«çš„å…¨éƒ¨æ´»åŠ¨å’Œä¼˜æƒ ï¼š</div>
                        <ul style="margin-bottom:16px;padding-left:20px;">
                            <li>æœˆä¸­æŠ½é»„é‡‘</li>
                            <li>å‘¨ä¸‰æŠ¢åˆ¸</li>
                            <li>å¤©å¤©ç­¾åˆ°</li>
                            <li>ç“œåˆ†æ´»åŠ¨</li>
                            <li>åå‘¨å¹´æŠ½å¥–</li>
                            <li>æ¢¦æƒ³åŠ©åŠ›</li>
                            <li>9æŠ˜/6æœŸå…æœŸ/1000å…ƒ3æœŸæœˆæ¯1å…ƒ</li>
                        </ul>
                        <div style="margin-bottom:12px;font-weight:600;">2. ä¼˜æƒ æŠ˜ç®—ä¸ºå•ç”¨æˆ·ç°é‡‘ä»·å€¼ï¼š</div>
                        <div style="background:#F8FAFC;padding:10px 14px;border-radius:10px;margin-bottom:14px;">
                            å‡è®¾å•ç¬”å€Ÿæ¬¾é‡‘é¢2ä¸‡å…ƒï¼Œåˆ†12æœŸï¼Œç»Ÿè®¡ä¸Šè¿°å…¨éƒ¨æ´»åŠ¨å’Œä¼˜æƒ ï¼ŒæŒ‰æ¦‚ç‡å’Œé¢é¢æŠ˜ç®—ä¸ºç”¨æˆ·å¯è·å¾—çš„ç°é‡‘ä»·å€¼ï¼ˆå¦‚æŠ½å¥–ç±»æŒ‰ä¸­å¥–æ¦‚ç‡*é¢é¢ï¼Œç­¾åˆ°/ç“œåˆ†/åˆ¸ç±»æŒ‰é¢é¢ç­‰ï¼‰ã€‚
                        </div>
                        <div style="margin-bottom:12px;font-weight:600;">3. ç°é‡‘ä»·å€¼æŠµæ‰£åˆ©æ¯åIRRè®¡ç®—è¿‡ç¨‹ï¼š</div>
                        <div style="background:#F8FAFC;padding:10px 14px;border-radius:10px;margin-bottom:14px;">
                            â‘  è®¡ç®—åŸå§‹æ€»åˆ©æ¯å’Œæœˆä¾›<br>
                            â‘¡ ç”¨å…¨éƒ¨ä¼˜æƒ ç°é‡‘ä»·å€¼æŠµæ‰£æ€»åˆ©æ¯<br>
                            â‘¢ ç”¨æŠµæ‰£åå®é™…è¿˜æ¬¾é¢é‡æ–°è®¡ç®—IRRï¼ˆå†…éƒ¨æ”¶ç›Šç‡ï¼‰<br>
                            â‘£ å¾—åˆ°ä¼˜æƒ åIRRï¼Œé€šå¸¸æ˜¾è‘—ä½äºç«å“
                        </div>
                        <div style="margin-bottom:12px;font-weight:600;">4. è®¡ç®—ç¤ºæ„å›¾ï¼š</div>
                        <div style='display:flex;align-items:center;gap:12px;margin-bottom:10px;'>
                            <div style='flex:1;text-align:center;'>
                                <div style='font-size:13px;color:#888;'>åŸå§‹IRR</div>
                                <div style='font-size:22px;font-weight:700;color:#1976FF;'>10.0%</div>
                            </div>
                            <span style='font-size:18px;color:#888;'>â†’</span>
                            <div style='flex:1;text-align:center;'>
                                <div style='font-size:13px;color:#888;'>ä¼˜æƒ ç°é‡‘ä»·å€¼æŠµæ‰£</div>
                                <div style='font-size:22px;font-weight:700;color:#00C853;'>-Â¥800</div>
                            </div>
                            <span style='font-size:18px;color:#888;'>â†’</span>
                            <div style='flex:1;text-align:center;'>
                                <div style='font-size:13px;color:#888;'>ä¼˜æƒ åIRR</div>
                                <div style='font-size:22px;font-weight:700;color:#00C853;'>8.0%</div>
                            </div>
                        </div>
                        <div style='margin-top:10px;color:#888;font-size:13px;'>* å…·ä½“ä¼˜æƒ é‡‘é¢åŠIRRä»¥å®é™…æ´»åŠ¨ä¸ºå‡†ï¼Œè®¡ç®—æ–¹å¼å…¬å¼€é€æ˜ã€‚</div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
    </script>
</body>
</html> 